!function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([/*!**********************************!*\
  !*** ../athenajs/dist/athena.js ***!
  \**********************************/
function(e,t,i){!function(t,i){e.exports=i()}(0,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=45)}([/*!*****************************!*\
  !*** ./js/Util/Deferred.js ***!
  \*****************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! es6-promise */19),r=i.n(s),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){var t=this;n(this,e),this.promise=new r.a(function(e,i){t.resolve=e,t.reject=i})}return o(e,null,[{key:"resolve",value:function(e){return r.a.resolve(e)}}]),e}();t.a=a},/*!******************************************!*\
  !*** ./js/Drawable/Behavior/Behavior.js ***!
  \******************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,i){n(this,e),this.sprite=t,t.gravity=void 0!==i.gravity?i.gravity:0,t.vx=void 0!==i.vx?i.vx:0,t.vy=void 0!==i.vy?i.vy:0,this.checkWalls=i.checkWalls||!1,this.checkFall=i.checkFall||!1,this.onVXChange=i.onVXChange||null,this.onVYChange=i.onVYChange||null}return s(e,[{key:"onUpdate",value:function(){}},{key:"getMapEvent",value:function(){return this.sprite.currentMap.mapEvent}}]),e}();t.a=r},/*!*********************************!*\
  !*** ./js/Drawable/Drawable.js ***!
  \*********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../FX/FX */3),r=i(/*! ./Behavior/Behaviors */21),o=i(/*! ../Notification/NotificationManager */9),a=i(/*! ../Audio/AudioManager */7),h=i(/*! ../Util/Deferred */0),u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function(){function e(t,i){if(n(this,e),this.type=t,this.id=i.objectId||this.type+(new Date).getTime(),this.layer=i.layer||0,this.currentMap=null,this.currentScene=null,this._destroyed=!1,this.children=[],this.wave=i.wave||null,this.behavior=null,this.platform=null,this.mask=null,this.collideGroup=i.collideGroup||0,this.canCollideFriendBullet=i.canCollideFriendBullet||!1,this.master=i.master||!1,this.moving=!1,this.easing=s.a.getEasing(i.easing||"linear"),i.behavior&&this.setBehavior(i.behavior,i.behaviorOptions),this._settings=Object.assign({speed:1,visible:!0,canCollide:!1,plane:0,x:0,y:0,vx:0,vy:0,scale:1,angle:0,movable:!0,gravity:0,data:{},path:null,target:null,targetOffsetX:0,targetOffsetY:0,wave:i.wave||null},i),this.target=null,this.spline=null,this.currentMovement="",this.fxQueue={},i.pool||(this._reset(),this.reset(),i.animate&&this.animate(i.animate.name,i.animate.options)),i.scene)return void i.scene.addObject(this);i.map}return u(e,[{key:"reset",value:function(){}},{key:"_reset",value:function(){this.speed=this._settings.speed,this.visible=this._settings.visible,this.canCollide=this._settings.canCollide,this.plane=this._settings.plane,this.x=this._settings.x,this.y=this._settings.y,this.opacity=this._settings.opacity||1,this.scale=this._settings.scale,this.angle=this._settings.angle,this.movable=this._settings.movable,this.moving=!1,this.data=this._settings.data,this.path=null,this.vx=this._settings.vx||0,this.vy=this._settings.vy||0,this.gravity=this._settings.gravity,this.moveHandlers=[],this.targetOffsetX=this._settings.targetOffsetX||0,this.targetOffsetY=this._settings.targetOffsetY||0,this.target=this._settings.target||null,this.savedX=this.x,this.savedY=this.y,this.wave=this._settings.wave}},{key:"setMap",value:function(e){this.currentMap=e,this.children.forEach(function(t){t.setMap(e)})}},{key:"setScene",value:function(e){this.currentScene=e,this.children.forEach(function(t){t.setScene(e)})}},{key:"setPlatform",value:function(e){this.platform=e}},{key:"moveTo",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.moving||(0===i?(this.x=e,this.y=t,this._onUpdate()):(console.log("moveTo from",this.x,"to",e),this.targetX=e,this.targetY=t,this.duration=i,this.startMoveTime=(new Date).getTime(),this.targetDistanceX=e-this.x|0,this.targetDistanceY=t-this.y|0,this.targetStartX=this.x,this.targetStartY=this.y,this.moving=!0)),this}},{key:"snapToMap",value:function(e,t){if(this.currentMap){var i=this.currentMap,n=i.getTileIndexFromPixel(this.x,this.y);this.x%i.tileWidth&&!e&&n.x++,this.y%i.tileHeight&&!t&&n.y++,n=i.getTilePixelPos(n.x,n.y),this.moveTo(n.x,n.y)}}},{key:"setMask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.mask=e,t&&e&&(e.exclude=!0)}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"cancelMoveTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.moving&&(this.moving=!1,e&&(this.x=this.targetX,this.y=this.targetY))}},{key:"center",value:function(){var e=this.currentScene.display;return this.x=(e.width-this.width)/2,this.y=(e.height-this.height)/2,this}},{key:"setBehavior",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.behavior="string"==typeof e?new(r.a.getBehavior(e))(this,t):new e(this,t)}},{key:"clearBehavior",value:function(){this.vx=this.vy=0,this.behavior=null}},{key:"_applyMask",value:function(e,t,i){if(this.mask){var n=this.mask;n.exclude?(e.save(),e.fillStyle=n.color||"black",e.fillRect(t+n.x,i+n.y,n.width,n.height)):(e.save(),e.beginPath(),e.rect(t+n.x,i+n.y,n.width,n.height),e.clip())}}},{key:"_undoMask",value:function(e){this.mask&&e.restore()}},{key:"update",value:function(e){if(this.movable){if(!0===this.moving){var t=e-this.startMoveTime,i=t/this.duration,n=0;t>=this.duration?(this.moving=!1,this.x=this.targetX,this.y=this.targetY):(n=this.easing(i,t,0,1,this.duration),this.x=this.targetStartX+n*this.targetDistanceX|0,this.y=this.targetStartY+n*this.targetDistanceY|0)}else this.behavior?this.behavior.onUpdate(e):(this.x+=this.vx,this.y+=this.vy,this.vy-=this.gravity);this.children.length&&this.children.forEach(function(e){e.update()})}}},{key:"savePosition",value:function(){this.savedX=this.x,this.savedY=this.y}},{key:"getSavedPosition",value:function(){return{x:this.savedX,y:this.savedY}}},{key:"moveWithSpline",value:function(){}},{key:"setPath",value:function(e){this.path=e}},{key:"setScale",value:function(e){this.scale=e}},{key:"setAngle",value:function(e){this.angle=e}},{key:"getAngle",value:function(){return this.angle}},{key:"transform",value:function(e,t){switch(e){case"scale":this.scale=t}}},{key:"hide",value:function(){return this.visible=!1,this}},{key:"show",value:function(){return this.visible=!0,this}},{key:"applyCtxAlpha",value:function(e){this._oldAlpha=e.globalAlpha,e.globalAlpha=this.opacity}},{key:"restoreCtxAlpha",value:function(e){e.globalAlpha=this._oldAlpha}},{key:"getCurrentWidth",value:function(){return this.width}},{key:"getCurrentHeight",value:function(){return this.height}},{key:"getHitBox",value:function(){return{x:0,y:0,x2:this.getCurrentWidth()-1,y2:this.getCurrentHeight()-1}}},{key:"showHitBox",value:function(e){if(this.visible){var t=this.getHitBox(),i=this.currentMap&&this.currentMap.viewportX||0,n=this.currentMap&&this.currentMap.viewportY||0;t&&(e.setTransform(1,0,0,1,0,0),e.strokeStyle="rgb(0,230,0)",e.beginPath(),e.moveTo(t.x+this.x+i,t.y+this.y+n),e.lineTo(t.x2+this.x+i,t.y+this.y+n),e.lineTo(t.x2+this.x+i,t.y2+this.y+n),e.lineTo(t.x+this.x+i,t.y2+this.y+n),e.lineTo(t.x+this.x+i,t.y+this.y+n),e.closePath(),e.stroke())}}},{key:"showObjectBox",value:function(e){e.strokeStyle="rgb(0,230,0)",e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.width+this.x,this.y),e.lineTo(this.width+this.x,this.y+this.height),e.lineTo(this.x,this.y+this.height),e.lineTo(this.x,this.y),e.closePath(),e.stroke()}},{key:"hitTest",value:function(e){var t=e.getHitBox(),i=!1;if(this.canCollide&&e.canCollide&&this!==e&&this.visible){var n=this.getHitBox(),s={x:this.x+n.x,y:this.y+n.y,x2:this.x+n.x+n.x2,y2:this.y+n.y2+n.y};(s.y<e.y+t.y&&s.y2>e.y+t.y||s.y>e.y+t.y&&s.y<e.y+t.y+t.y2)&&(s.x<e.x+t.x&&s.x2>e.x+t.x||s.x>e.x+t.x&&s.x<e.x+t.x+t.x2)&&(e.onCollision(this),this.onCollision(e),i=!0)}if(!i)for(var r=this.children.length,o=0;!i&&o<r;)i=this.children[o].hitTest(e),o++;return i}},{key:"setTarget",value:function(e){this.target=e}},{key:"addMoveHandler",value:function(e){this.moveHandlers.push(e)}},{key:"onHit",value:function(e){console.log("[Drawable] oops, ",this.type," [",this.id,"] ","was hit by",e.name," [",e.id,"]")}},{key:"_onUpdate",value:function(){var e=[this.x,this.y];this.moveHandlers.forEach(function(t){return t.apply(void 0,e)})}},{key:"isFxQueueEmpty",value:function(){for(var e in this.fxQueue)return!1;return!0}},{key:"animate",value:function(e,t){var i=this,n=s.a.getEffect(e),r=(new h.a).resolve(),o=t.easing||"linear",a=void 0;return void 0!==this.fxQueue[e]?console.warn("Fx",e,"already in progress, cannot execute twice"):n?(a=new n(t),a.setEasing(new s.a.getEasing(o)),r=a.start().then(function(){delete i.fxQueue[e]}).catch(function(e){console.error(e)}),this.fxQueue[e]=a):console.warn("Fx",e,"unknown: did you spell it correctly ?"),r}},{key:"stopAnimate",value:function(e){var t=this,i=null;Object.keys(this.fxQueue).forEach(function(n){i=t.fxQueue[n],i.stop(t,e)})}},{key:"executeFx",value:function(e,t){var i=this,n=null;Object.keys(this.fxQueue).forEach(function(s){n=i.fxQueue[s],n.process(e,null,i,t)})}},{key:"onCollision",value:function(){}},{key:"addChild",value:function(e){e.setMap(this.currentMap),e.setScene(this.currentScene),this.children.push(e)}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);t>-1&&(this.children[t].destroy(),this.children.splice(t,1))}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;++e)this.children[e].destroy();this.children.length=0}},{key:"setImage",value:function(e){}},{key:"_draw",value:function(e){this.applyCtxAlpha(e),this.draw(e),this.restoreCtxAlpha(e)}},{key:"playSound",value:function(e,t){var i=0,n=this.currentMap,s=1,r=t||{pan:!0,loop:!1};(n&&(this.x<-n.viewportX||this.x>-n.viewportX+n.viewportW)||this.y<-n.viewportY||this.y>-n.viewportY+n.viewportH)&&(s=.2),n&&r.pan&&(i=this.x<n.masterObject.x?-5:5),this.sound=a.a.play(e,r.loop||!1,s,i)}},{key:"notify",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.a.notify(this.type+":"+e,t)}},{key:"destroy",value:function(){this._destroyed=!0,"function"==typeof this.freeFromPool&&this.freeFromPool(),this.currentMap?this.currentMap.removeObject(this):this.currentScene&&this.currentScene.removeObject(this),this.children.forEach(function(e){e.destroy()}),this.wave&&this.wave.remove(this)}}]),e}();t.a=l},/*!*********************!*\
  !*** ./js/FX/FX.js ***!
  \*********************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ./Effect/Fade */35),r=i(/*! ./Effect/Rotate */37),o=i(/*! ./Effect/Custom */34),a=i(/*! ./Effect/Mosaic */36),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u={},l={},c=function(){function e(){n(this,e),this.addEasing("linear",function(e){return e})}return h(e,[{key:"addFX",value:function(e,t){u[e]=t}},{key:"getEffect",value:function(e){return u[e]}},{key:"addEasing",value:function(e,t){l[e]=t}},{key:"getEasing",value:function(e){return l[e]||l.linear}}]),e}(),f=new c;f.addFX("Mosaic",a.a),f.addFX("Fade",s.a),f.addFX("Rotate",r.a),f.addFX("Custom",o.a),t.a=f},/*!************************!*\
  !*** ./js/Map/Tile.js ***!
  \************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){n(this,e),this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.width=t.width||16,this.height=t.height||16,this.inertia=t.inertia||1,this.upCollide=t.upCollide||!0,this.downCollide=t.downCollide||!0}return s(e,null,[{key:"TYPE",get:function(){return{AIR:1,WALL:2,LADDER:3}}}]),e}();t.a=r},/*!****************************************!*\
  !*** ./js/Resource/ResourceManager.js ***!
  \****************************************/
function(e,t,i){"use strict";function n(e){return new(e.bind.apply(e,arguments))}var s=i(/*! ../Util/Binary */17),r=i(/*! ../Audio/AudioManager */7),o=i(/*! ../Util/Pool */18),a=i(/*! web-audio-daw */42),h=i.n(a),u=i(/*! ../Util/Deferred */0),l=i(/*! ../Util/Dom */6),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=window.createImageBitmap||function(e){return u.a.resolve(e)},d={isLocal:!!document.location.href.match(/^file:\/\//),scriptMaxTime:3e3,groupMaxTime:5e3,resources:{any:{def:new u.a,loadedRes:0,numRes:0,res:{},progressCb:null,errorCb:null}},dynamicScripts:{},iOS:!!navigator.userAgent.match(/iPhone|iPad/),skipResources:["script"],async:!0,loading:!1,getResourceById:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.resources[t].res,s=n[e];return s&&s.loaded?!0===i?s:s.elt:this.dynamicScripts[e]?this.dynamicScripts[e]:void console.error("[RM] unknwon resource id",e)},newResourceFromPool:function(e){var t=this.getResourceById(e);return"function"==typeof t.createFromPool?t.createFromPool.apply(t,Array.prototype.slice.call(arguments,1)):n.apply(void 0,[t].concat(Array.prototype.slice.call(arguments,1)))},_createGroup:function(e){this._groupExists(e)?this.resources[e].def=new u.a:this.resources[e]={def:new u.a,loadedRes:0,numRes:0,res:{},progressCb:null,errorCb:null}},_groupExists:function(e){return void 0!==this.resources[e]},addResources:function(e,t){t=t||"any",this._createGroup(t);var i=void 0,n=this.resources[t];if(null!==e)if("object"===(void 0===e?"undefined":c(e))&&e.constructor===Array)for(i in e)void 0===n.res[e[i].id]&&-1===this.skipResources.indexOf(e[i].type)&&(n.res[e[i].id]=JSON.parse(JSON.stringify(e[i])),n.numRes++);else void 0===n.res[e.id]&&-1===this.skipResources.indexOf(e.type)&&(n.res[e.id]=JSON.parse(JSON.stringify(e)),n.numRes++);return null!==e&&n.numRes!==n.loadedRes||n.def.resolve(!0),n.def.promise},loadNextResource:function(e){var t=this.resources[e],i=void 0;for(i in t.res)if(!t.res[i].loaded&&-1===this.skipResources.indexOf(t.res[i].type)){this._loadResource(t.res[i],e);break}},loadResources:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(e=e||"any",!0===this.loading)return void console.warn("[ResourceManager] loadResources() -> already loading");this.loading=!0;var s=this.resources[e],r=null,o=void 0,a=0;s.progressCb=i||null,s.errorCb=n||null;for(o in s.res)s.res[o].loaded||-1!==this.skipResources.indexOf(s.res[o].type)||(a++,this.async?this._loadResource(s.res[o],e):null===r&&(r=s.res[o]));if(this.async||this._loadResource(r,e),0===a)return void(this.loading=!1);s.gpTimeout=setTimeout(function(){var e,i=[];if(s.gpTimeout){s.gpTimeout=null,console.error("[RM] Unable to load the following resources after",t.groupMaxTime/1e3,"sec");for(e in s.res)s.res[e].loaded||(i.push("["+s.res[e].type+"] "+e),console.warn("["+s.res[e].type+"] "+e+": "+s.res[e].src));s.errorCb&&s.errorCb("Unable to get all resources after",t.groupMaxTime,i)}},this.groupMaxTime)},getCanvasFromImage:function(e){var t=document.createElement("canvas");return t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0),t},loadImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=new Image,n=this,s=new u.a;return i.onload=function(){f(this).then(function(r){e.elt=r,e.img=i,e.loaded=!0,t&&n._resLoaded(t),s.resolve(t&&!0||r)})},i.src=e.src,s.promise},createObjectPool:function(e,t){o.a.create(e,t)},registerScript:function(e,t,i){var n=this.dynamicScripts[e];i&&this.createObjectPool(t,i),n?console.error("existing script with the id",e,"should I replace it?"):this.dynamicScripts[e]=t},loadScript:function(e,t,i){var n=new u.a;return console.error("loadScript not supported"),console.log("[RM] loading script",e.src),n.promise},loadAudio:function(e,t){function i(){this.removeEventListener("canplaythrough",i),e.elt=this,e.loaded=!0,r.a.addSound(e.id,this),n._resLoaded(t),o.resolve(!0)}var n=this,s=new Audio,o=new u.a;return s.preload="auto",s.addEventListener("canplaythrough",i),s.addEventListener("loadstart",function(){console.log("loadStarted",s.src)}),s.src=e.src,o.promise},loadWadAudio:function(e,t){var i=this,n=new u.a,s=new h.a({source:e.src,callback:function(){e.elt=s,e.loaded=!0,r.a.addSound(e.id,s),i._resLoaded(t),n.resolve(!0)}});return n.promise},loadJSON:function(e,t,i){var n=this,s=new u.a;fetch(e.src).then(function(e){if(200===e.status)return e.json();throw"Error getting photo list"}).then(function(r){if(e.elt=r,e.loaded=!0,i){i.call(n,e,t).then(function(){s.resolve(!0)})}else n._resLoaded(t),s.resolve(!0)})},loadMapData:function(e,t){var i=this,n=new u.a,r=this.resources[t];return s.a.getArrayBuffer((document.location.href.match("warpdesign.fr")?"/gods/":"")+e.elt.dataUrl).then(function(s){e.elt.buffer=s,e.loaded=!0,i._resLoaded(t),n.resolve(!0)},function(){r.def.reject('Unable to load map resource "'+e.src+'" ['+e.id+"]")}),n.promise},_resLoaded:function(e){var t=this.resources[e];t.loadedRes++,new l.a("span.loaded").html(t.loadedRes),t.progressCb&&t.progressCb.call(this,Math.floor(100*t.loadedRes/t.numRes)),t.loadedRes===t.numRes?(this.loading=!1,null!==t.gpTimeout&&clearTimeout(t.gpTimeout),t.def.resolve(!0)):this.async||this.loadNextResource(e)},_loadResource:function(e,t){switch(e.type){case"image":return this.loadImage(e,t);case"audio":return this.loadWadAudio(e,t);case"script":return this.loadScript(e,t);default:return this.loadJSON(e,t,this.loadMapData)}}};t.a=d},/*!************************!*\
  !*** ./js/Util/Dom.js ***!
  \************************/
function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!(this instanceof s))return new(Function.prototype.bind.apply(s,[null].concat(Array.prototype.slice.call(arguments))));null!==e&&(e instanceof HTMLElement?this.push(e):e.match(/^#|\./)?this.push.apply(this,n(document.querySelectorAll(e))):this.push(document.createElement(e)))}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};s.prototype=new Array,Object.assign(s.prototype,{css:function(e,t){if("object"===(void 0===e?"undefined":r(e)))this.forEach(function(t){var i=t.style;for(var n in e)i[n]=e[n]});else{if(void 0===t)return this.length?this[0].style[e]:null;this.forEach(function(i){i.style[e]=t})}return this},find:function(e){var t=new s;return this.forEach(function(i){for(var n=i.querySelectorAll(e),s=0;s<n.length;++s)t.push(n[s])}),t},appendTo:function(e){var t="object"===(void 0===e?"undefined":r(e))&&e||document.querySelector(e);return t&&this.forEach(function(e){t.appendChild(e)}),this},attr:function(e,t){return"object"===(void 0===e?"undefined":r(e))?this.forEach(function(t){for(var i in e)t.setAttribute(i,e[i])}):this.forEach(function(i){i.setAttribute(e,t)}),this},addClass:function(e){var t=e.split(" ");return this.forEach(function(e){var i;(i=e.classList).add.apply(i,n(t))}),this},removeClass:function(e){var t=e.split(" ");this.forEach(function(e){var i;(i=e.classList).remove.apply(i,n(t))})},html:function(e){return this.forEach(function(t){return t.innerHTML=e}),this},show:function(){return this.forEach(function(e){e.style.display="block"}),this},hide:function(){return this.forEach(function(e){e.style.display="none"}),this}}),t.a=s},/*!**********************************!*\
  !*** ./js/Audio/AudioManager.js ***!
  \**********************************/
function(e,t,i){"use strict";var n={audioCache:{},enabled:!0,addSound:function(e,t){this.audioCache[e]=t},toggleSound:function(e){this.enabled=e},play:function(e,t,i,n){var s=null;if(this.enabled)return void 0===(s=this.audioCache[e])?void console.warn("[AM] could not find sound, did you load:",e):("function"==typeof s.loop?s.loop(t||!1):s.loop=t||!1,s.play({panning:[n||0,0,5],volume:i||1,loop:t||!1}))},stop:function(e,t){var i=null;if(this.enabled){try{i=this.audioCache[e]}catch(t){return void console.warn("[AM] WARN: unable to stop sound",e)}i&&"function"==typeof i.stop&&i.stop(t||void 0)}}};t.a=n},/*!********************************!*\
  !*** ./js/FX/Effect/Effect.js ***!
  \********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../../Util/Deferred */0),r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i){n(this,e),this.easing=null,this.context=t.context||this,void 0!==i&&(this.width=i.width,this.height=i.height),this.startValue=void 0!==t.startValue?t.startValue:0,this.endValue=void 0!==t.endValue?t.endValue:1,this.loop=void 0===t.loop?0:t.loop,this.loops=0,this.duration=t.duration||400}return r(e,[{key:"setEasing",value:function(e){this.easing=e}},{key:"start",value:function(){return this.loops||(this.def=new s.a),this.startTime=(new Date).getTime(),this.ended=!1,this.stopped=!1,this.def.promise}},{key:"stop",value:function(e,t){this.stopped=!0}},{key:"process",value:function(e,t,i){var n=(new Date).getTime(),s=n-this.startTime,r=s/this.duration;return this.stopped||s>=this.duration?(this.loops++,this.stopped||this.loops>=this.loop?(this.animProgress=1,this.ended=!0,this.def.resolve(!0)):this.start()):this.animProgress=this.easing(r,s,0,1,this.duration),this.ended}}]),e}();t.a=o},/*!************************************************!*\
  !*** ./js/Notification/NotificationManager.js ***!
  \************************************************/
function(e,t,i){"use strict";var n={},s={notify:function(e,t){var i={type:e,data:t};n[e]?n[e].forEach(function(e){return e(i)}):n["*"]&&n["*"].forEach(function(e){return e(i)})},listen:function(e,t){console.log("[NotificationManager] listening to event(s) "+e),e.replace(/\s+/g," ").split(" ").forEach(function(e){n[e]||(n[e]=[]),n[e].push(t)})}};window.NM=s,t.a=s},/*!**********************************!*\
  !*** ./js/Input/InputManager.js ***!
  \**********************************/
function(e,t,i){"use strict";for(var n={KEYS:{UP:38,DOWN:40,LEFT:37,RIGHT:39,SPACE:32,ENTER:13,ESCAPE:27,CTRL:17},PAD_BUTTONS:{32:1,FACE_0:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,38:12,40:13,37:14,39:15},axes:{},newGamepadPollDelay:1e3,gamepadSupport:!1,recording:!1,playingEvents:!1,playingPos:0,recordedEvents:[],pad:null,latches:{},keyPressed:{},padPressed:{},keyCb:{},enabled:!0,inputMode:"keyboard",dPadJoystick:null,jPollInterval:0,init:function(){this._generateKeyCodes(),this._installInputModeSwitchHandler(),this._installKBEventHandlers(),this._pollNewGamepad(),this.setInputMode(this.inputMode)},_generateKeyCodes:function(){for(var e=65;e<91;++e)this.KEYS[String.fromCharCode(e)]=e},_installInputModeSwitchHandler:function(){var e=this;document.addEventListener("touchstart",function(){e.setInputMode("joystick")})},startRecordingEvents:function(){this.recording||(this.recordedEvents.length=0,this.recording=!0,console.log("[InputManager] Starting record of input events!"))},stopRecordingEvents:function(){this.recording=!1,console.log("[InputManager] Stoping record of input events, recorded",this.recordedEvents.length,"events")},playRecordedEvents:function(){this.playingEvents||(console.log("[InputManager] Starting to play an existing record of input events!"),this.playingEvents=!0,this.playPos=0)},nextRecordedEvents:function(){this.playingPos>=this.recordedEvents.length?(this.playingEvents=!1,this.keyPressed={38:!1,40:!1,37:!1,39:!1,32:!1,13:!1,27:!1,17:!1},console.log("[InputManager] Reached the end of recorded events, resetting keys status to default!")):this.keyPressed=this.recordedEvents[this.playingPos++]},recordEvents:function(){this.recordedEvents.push(JSON.parse(JSON.stringify(this.keyPressed)))},setInputMode:function(e){if(this.inputMode!==e){switch(e){case"virtual_joystick":this.dPadJoystick&&(this.jPollInterval=setInterval(this._pollJoystick.bind(this),1/30*1e3));break;case"keyboard":this._clearJoystickPoll();break;case"gamepad":this._clearJoystickPoll(),requestAnimationFrame(this._pollGamepad.bind(this))}this._resetKeys(),this.inputMode=e}},_resetKeys:function(){for(var e in this.keyPressed)this.keyPressed[e]=!1,this.latches[e]=!1},_pollNewGamepad:function(){var e=this,t=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads(),i=null;if(t&&t.length)for(var n=0;n<t.length;++n)(i=t[n])&&(this.pad=i,this.gamepadSupport||(console.log("[Event] Oh oh! Looks like we have a new challenger: ",i.id),this.gamepadSupport=!0,this.setInputMode("gamepad")));this.gamepadSupport||setTimeout(function(){e._pollNewGamepad()},this.newGamepadPollDelay)},_pollGamepad:function(){this._pollNewGamepad(),this.pad.buttons[12].pressed&&!this.latches[this.KEYS.UP]?(this.keyPressed[this.KEYS.UP]=!0,this.keyPressed[this.KEYS.DOWN]=!1):this.pad.buttons[13].pressed&&!this.latches[this.KEYS.DOWN]?(this.latches[this.KEYS.UP]=!1,this.keyPressed[this.KEYS.DOWN]=!0,this.keyPressed[this.KEYS.UP]=!1):(this.latches[this.KEYS.UP]=!1,this.latches[this.KEYS.DOWN]=!1,this.keyPressed[this.KEYS.DOWN]=!1,this.keyPressed[this.KEYS.UP]=!1),this.pad.buttons[15].pressed&&!this.latches[this.KEYS.RIGHT]?(this.keyPressed[this.KEYS.RIGHT]=!0,this.keyPressed[this.KEYS.LEFT]=!1):this.pad.buttons[14].pressed?(this.latches[this.KEYS.RIGHT]=!1,this.keyPressed[this.KEYS.LEFT]=!0,this.keyPressed[this.KEYS.RIGHT]=!1):(this.latches[this.KEYS.RIGHT]=!1,this.latches[this.KEYS.LEFT]=!1,this.keyPressed[this.KEYS.LEFT]=!1,this.keyPressed[this.KEYS.RIGHT]=!1),this.pad.buttons[0].pressed&&!this.latches[this.KEYS.SPACE]?this.keyPressed[this.KEYS.SPACE]=!0:this.pad.buttons[0].pressed||(this.latches[this.KEYS.SPACE]=!1,this.keyPressed[this.KEYS.SPACE]=!1),this.pad.buttons[1].pressed&&!this.latches[this.KEYS.CTRL]?this.keyPressed[this.KEYS.CTRL]=!0:this.pad.buttons[1].pressed||(this.latches[this.KEYS.CTRL]=!1,this.keyPressed[this.KEYS.CTRL]=!1),this.jPollInterval=requestAnimationFrame(this._pollGamepad.bind(this))},_getModifiers:function(){return{ALT:!0,SHIFT:!0,CTRL:!0,META:!0}},_initVirtualJoystick:function(){var e=this,t=void 0,i=void 0;console.log("[InputManager] _initVirtualJoystick"),t=this.dPadJoystick=new VirtualJoystick({container:document.body,strokeStyle:"cyan",limitStickTravel:!0,mouseSupport:!0,stickRadius:60}),t.addEventListener("touchStartValidation",function(e){return!(e.changedTouches[0].pageX>=window.innerWidth/2)}),i=this.fireJoystick=new VirtualJoystick({container:document.body,strokeStyle:"orange",limitStickTravel:!0,mouseSupport:!0,stickRadius:0}),i.addEventListener("touchStartValidation",function(e){return!(e.changedTouches[0].pageX<window.innerWidth/2)}),i.addEventListener("touchStart",function(){"virtual_joystick"===e.inputMode&&(e.keyPressed[e.KEYS.CTRL]=!0)}),i.addEventListener("touchEnd",function(){"virtual_joystick"===e.inputMode&&(e.keyPressed[e.KEYS.CTRL]=!1)})},_clearJoystickPoll:function(){this.jPollInterval&&(cancelAnimationFrame(this.jPollInterval),this.jPollInterval=0)},_pollJoystick:function(){var e=this,t=[],i=[],n=this.dPadJoystick;Math.abs(n.deltaX())>=10?n.left()?(t.push("LEFT"),i.push("RIGHT")):(t.push("RIGHT"),i.push("LEFT")):(i.push("LEFT"),i.push("RIGHT")),Math.abs(n.deltaY())>=10?n.up()?(t.push("UP"),i.push("DOWN")):(t.push("DOWN"),i.push("UP")):(i.push("UP"),i.push("DOWN")),t.length&&t.forEach(function(t){e.keyPressed[e.KEYS[t]]=!0}),i.length&&i.forEach(function(t){e.keyPressed[e.KEYS[t]]=!1})},_installKBEventHandlers:function(){var e=this;document.addEventListener("keydown",function(t){if("keyboard"===e.inputMode&&!e.playingEvents){switch(t.keyCode){case 32:case 37:case 38:case 39:case 40:t.preventDefault()}t.keyCode&&!e.latches[t.keyCode]&&(e.keyPressed[t.keyCode]=!0),e.metas=e._getModifiers(),e.enabled&&e.keyCb[t.keyCode]&&e.keyCb[t.keyCode].down.forEach(function(e){e(String.fromCharCode(t.keyCode),t)})}}),document.addEventListener("keyup",function(t){"keyboard"!==e.inputMode||e.playingEvents||(t.keyCode&&(e.keyPressed[t.keyCode]=!1,e.latches[t.keyCode]=!1),e.metas=e._getModifiers(),e.enabled&&e.keyCb[t.keyCode]&&e.keyCb[t.keyCode].up.forEach(function(e){e(String.fromCharCode(t.keyCode),t)}))})},getAllKeysStatus:function(){for(var e=Object.keys(this.KEYS),t={},i=0;i<e.length;++i)t[e[i]]=this.getKeyStatus(e[i]);return t},getKeyStatus:function(e,t){var i=void 0;try{return i=this.keyPressed[e]||this.padPressed[e],i&&!0===t&&(this.keyPressed[e]=!1,this.latches[e]=!0),i}catch(e){throw e}},isKeyDown:function(e,t){var i="string"==typeof e&&this.KEYS[e]||e;return this.getKeyStatus(i,t)},installKeyCallback:function(e,t,i){var n=this;e.split(" ").forEach(function(e){var s=n.KEYS[e];n.keyCb[s]||(n.keyCb[s]={up:[],down:[]}),n.keyCb[s][t].push(i)})},removeKeyCallback:function(e,t,i){var n=this.keyCb[e][t].indexOf(i);n>-1&&this.keyCb[e][t].splice(n,1)},clearEvents:function(){this.keyPressed={},this.keyCb={}}},s=0;s<10;++s)n.KEYS[s.toString()]=s+48;[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}("ABCDEFGHIJKLMNOPQRSTUVWXYZ")).forEach(function(e,t){n.KEYS[e]=65+t}),t.a=n},/*!*******************************!*\
  !*** ./js/Display/Display.js ***!
  \*******************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../FX/FX */3),r=i(/*! ../Util/Deferred */0),o=i(/*! ../Util/Dom */6),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function(){function e(t,s){n(this,e);var r=function(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1];return{dom:"WebKit|Moz|MS|O".match(new RegExp("("+t+")","i"))[1],lowercase:t,css:"-"+t+"-",js:t[0].toUpperCase()+t.substr(1)}}();this.layers=new Array(t.layers.length+1),this.layersIndex=t.layers,this.sortedLayers=this._sortLayers(),this.prefix=r.lowercase,this.target=s||i.i(o.a)("div").attr("id","display_"+t.name).appendTo("body")[0],this.width=t.width,this.height=t.height,this.type=t.type||"2d",this.fxCtx=null,this.isFullscreen=!1,this._addFullscreenEvents(),this._createLayers(),this.fxQueue={pre:{},post:{}}}return a(e,[{key:"getBuffer",value:function(e,t){var n=i.i(o.a)("canvas").attr({width:e+"px",height:t+"px"})[0].getContext("2d");return n.imageSmoothingEnabled=!1,n}},{key:"_addFullscreenEvents",value:function(){var e=this.target;e.addEventListener("webkitfullscreenchange",this._onFullscreenChange.bind(this),!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange.bind(this),!1),e.addEventListener("fullscreenchange",this._onFullscreenChange.bind(this),!1),e.addEventListener("MSFullscreenChange",this._onFullscreenChange.bind(this),!1)}},{key:"_onFullscreenChange",value:function(){var e=document.webkitFullscreenElement||document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(this.isFullscreen=e===this.target,this.isFullscreen){var t=this._getFullScreenSize(this.width,this.height);console.log("size",t.scaleX,t.scaleY),i.i(o.a)(this.target).css({width:t.width+"px",height:t.height+"px"}).find("canvas").css({width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"})}else i.i(o.a)(this.target).css({width:this.width+"px",height:this.height+"px"}).find("canvas").css({width:this.width+"px",height:this.height+"px",top:0,left:0})}},{key:"_getFullScreenSize",value:function(e,t){var i,n,s=e/t,r=navigator.userAgent.match(/Edge|Firefox/),o=navigator.userAgent.match(/Edge/),a=screen.width,h=screen.height;return o&&(a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,h=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),console.log("screen",screen.width,screen.height),s>0?(n=h,i=n*s):(i=a,n=i*s),{width:i,height:n,scaleX:i/e,scaleY:n/t,top:r?(h-n)/2:0,left:r?(a-i)/2:0}}},{key:"toggleFullscreen",value:function(){this.isFullscreen=!this.isFullscreen,this.isFullscreen?(console.log("request fullscreen"),this.target.requestFullScreen=this.target.requestFullscreen||this.target.webkitRequestFullscreen||this.target.mozRequestFullScreen||this.target.msRequestFullscreen,this.target.requestFullScreen?this.target.requestFullScreen():console.warn("Request fullscreen support not detected.")):(console.log("exit fullscreen"),document.exitFullScreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozExitFullScreen||document.msExitFullscreen,document.exitFullScreen?document.exitFullScreen():console.log("Exit fullscreen support not detected."))}},{key:"_createLayers",value:function(){var e=void 0;for(e=0;e<this.layers.length;++e)this.layers[e]=i.i(o.a)("canvas").addClass("layer_"+e).attr({width:this.width,height:this.height}).css({width:this.width+"px",height:this.height+"px",position:"absolute",zIndex:this._getLayerZIndex(e)}).appendTo(this.target)[0].getContext(this.type),this.layers[e].imageSmoothingEnabled=!1;this.fxCtx=i.i(o.a)("canvas").addClass("fx").attr({width:this.width,height:this.height}).css({width:this.width+"px",height:this.height+"px",position:"absolute",zIndex:3}).appendTo(this.target)[0].getContext(this.type),this.fxCtx.imageSmoothingEnabled=!1}},{key:"_getLayerZIndex",value:function(e){if(e<this.layersIndex.length){return this.layersIndex[e]?0:2}return 1}},{key:"_sortLayers",value:function(){var e=[];return this.layersIndex.forEach(function(t,i){t&&e.push(i)}),e.push(this.layers.length-1),this.layersIndex.forEach(function(t,i){t||e.push(i)}),e}},{key:"setLayerZIndex",value:function(e,t){e<this.layers.length&&(i.i(o.a)(this.layers[e].canvas).css("zIndex",t),this.layersIndex[e]=0===t,this.orderedLayers=this._sortLayers())}},{key:"clearScreen",value:function(e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.width,this.height)}},{key:"clearAllScreens",value:function(){for(var e=0;e<this.layers.length;++e)this.clearScreen(this.layers[e]);this.clearScreen(this.fxCtx)}},{key:"setCanvasOpacity",value:function(e,t){e.style.opacity=t}},{key:"renderScene",value:function(e){this.clearScreen(this.fxCtx),this.executeFx(null,null,e,null,"pre");for(var t=0;t<this.layers.length;++t)this.setCanvasOpacity(this.layers[t].canvas,Object.keys(this.fxQueue.post).length?0:e.getOpacity());for(var i=0;i<this.layers.length-1;i++)this.clearScreen(this.layers[i]);if(e.render(this.layers),e.hudScene&&e.hudScene.render(this.layers),Object.keys(this.fxQueue.post).length){this.clearScreen(this.fxCtx),this.setCanvasOpacity(this.fxCtx.canvas,0);for(var n=0;n<this.layers.length;++n){var s=this.sortedLayers[n];this.fxCtx.drawImage(this.layers[s].canvas,0,0)}}this.executeFx(this.fxCtx,this.fxCtx,e,null,"post"),Object.keys(this.fxQueue.post).length&&this.setCanvasOpacity(this.fxCtx.canvas,1)}},{key:"prepareCanvas",value:function(e){var t=null,i=0,n="";for(i=0;i<this.layers.length;++i)t=this.layers[i],n=t.canvas.style.display,t.canvas.style.display="none",e.forEach(function(e){"image"===e.type&&t.drawImage(e.elt,0,0)}),this.clearScreen(t),t.canvas.style.display=n}},{key:"animate",value:function(e,t,i){var n,o,a=this,h=s.a.getEffect(e),u=t.easing||"linear",l=t.when||"pre";if(t.context=i||this,void 0!==this.fxQueue[l][e]){console.warn("[Display] animate() - "+e+" already in progress, cannot execute twice.");var c=new r.a;c.resolve(),n=c.promise}else h?(o=new h(t,this),o.setEasing(new s.a.getEasing(u)),n=o.start().then(function(){delete a.fxQueue[l][e]}).catch(function(e){console.error(e)}),this.fxQueue[l][e]=o):console.warn("[Display] animate() - "+e+" unknown: did you spell it correctly ?");return n}},{key:"stopAnimate",value:function(){console.log("TODO: need to stop animation")}},{key:"executeFx",value:function(e,t,i,n,s){var r;s=s||"pre";for(var o in this.fxQueue[s])r=this.fxQueue[s][o],r.process(e,t,i,n)}},{key:"clearDisplay",value:function(){this.fxQueue.pre={},this.fxQueue.post={},this.clearAllScreens()}}]),e}();t.a=h},/*!**************************************!*\
  !*** ./js/Display/DisplayManager.js ***!
  \**************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ./Display */11),r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e),this.displays={}}return r(e,[{key:"addDisplay",value:function(e,t){return console.log("[Display Manager] adding display",e.name),this.displays[e.name]=new s.a(e,t),this.displays[e.name]}},{key:"getDisplay",value:function(e){return this.displays[e]}}]),e}();t.a=new o},/*!***********************************!*\
  !*** ./js/Drawable/SimpleText.js ***!
  \***********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Drawable */2),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SimpleText"+(new Date).getTime(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.fontFace=i.fontFace||"Arial",r.fontStyle=i.fontStyle||"normal",r.fontSize=i.fontSize||"18px",r.fontWeight=i.fontWeight||"normal",r.align=i.align||"center",r.color=i.color||"white",r.width=i.width||0,r.height=i.height||0,r.buffer=null,r.text=i.text||"",r}return r(t,e),a(t,[{key:"createBuffer",value:function(e){var t=this.fakeWidth||0,i=this.fakeHeight||0;this.buffer=e.getBuffer(t,i)}},{key:"clearBuffer",value:function(){this.currentScene.display.clearScreen(this.buffer)}},{key:"moveWithSpline",value:function(){}},{key:"setSize",value:function(e,t){null!==e&&(this.width=e),null!==t&&(this.height=t)}},{key:"prepareRender",value:function(){this._setFont(),this.lines=this.text.split("\n"),this.buffer?this.clearBuffer():this.createBuffer(this.currentScene.display),this.getMetrics()}},{key:"getMetrics",value:function(){var e=this.buffer;e.font=this.font,this.fakeLineHeight=parseInt(e.font),this.fakeHeight=this.lines.length*this.fakeLineHeight,this.fakeWidth=e.measureText(this.text).width,e.canvas.width=this.fakeWidth,e.canvas.height=this.fakeHeight,e.fillStyle=this.color,e.font=this.font,e.textBaseline="top"}},{key:"renderText",value:function(){this.prepareRender();for(var e=0;e<this.lines.length;++e)this.buffer.fillText(this.lines[e],0,this.fakeLineHeight*e)}},{key:"setText",value:function(e){this.text=e,this.renderText()}},{key:"setScene",value:function(e){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setScene",this).call(this,e),this.setText(this.text)}},{key:"setColor",value:function(e){this.color=e,this.renderText()}},{key:"getHitBox",value:function(){return{x:0,y:0,x2:this.w,y2:this.y}}},{key:"getCurrentWidth",value:function(){return this.fakeWidth}},{key:"getCurrentHeight",value:function(){return this.fakeHeight}},{key:"getCurrentOffsetX",value:function(){return this.offsetX}},{key:"getCurrentOffsetY",value:function(){return this.offsetY}},{key:"onHit",value:function(e){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onHit",this).call(this,e),console.log("oops, ",this.type," [",this.id,"] ","was hit by",e.name," [",e.id,"]")}},{key:"draw",value:function(e){var t=this.fakeWidth*this.scale,i=this.fakeHeight*this.scale,n=Math.floor(t/2),s=Math.floor(i/2),r=this.currentMap&&this.currentMap.viewportX||0,o=this.currentMap&&this.currentMap.viewportY||0,a=this.fakeWidth,h=this.fakeHeight;this.visible&&this.buffer&&(this.executeFx(e),e.setTransform(this.scale,0,0,this.scale,this.x+r+n,this.y+o+s),e.rotate(this.angle),e.drawImage(this.buffer.canvas,0,0,Math.floor(a),Math.floor(h),Math.floor(-n),Math.floor(-s),Math.floor(t),Math.floor(i)))}},{key:"_setFont",value:function(){this.font=this.fontSize+" "+this.fontFace}}]),t}(o.a);t.a=u},/*!*****************************!*\
  !*** ./js/Drawable/Wave.js ***!
  \*****************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../Resource/ResourceManager */5),r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t){n(this,e),this.counter=t.size,this.type=t.afterDestroy,this.data=t.afterDestroyData}return r(e,[{key:"remove",value:function(e){--this.counter||this.destroy(e)}},{key:"getSpriteOptions",value:function(e){var t=Object.assign({},this.data.spriteOptions);return"string"==typeof t.x&&(t.x=e.x+Number(t.x)),"string"==typeof t.y&&(t.y=e.y+Number(t.y)),t}},{key:"destroy",value:function(e){switch(this.type){case"reward":if(this.data){var t=this.getSpriteOptions(e,this.data),i=new(s.a.getResourceById(this.data.spriteId))(t);e.currentMap.addObject(i)}break;default:throw this.type}}}]),e}();t.a=o},/*!***********************!*\
  !*** ./js/Map/Map.js ***!
  \***********************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ./Tile */4),r=i(/*! ../Resource/ResourceManager */5),o=i(/*! ../Notification/NotificationManager */9),a=i(/*! ../FX/FX */3),h=i(/*! ./MapEvent */16),u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();window.maps={};var l=function(){function e(t){n(this,e),this.options=t,this.src=t.src,this.tileWidth=t.tileWidth||64,this.tileHeight=t.tileHeight||32,this.width=t.width||1024,this.height=t.height||1024,this.addTileSet(t.tiles),this.viewportX=t.viewportX||0,this.viewportY=t.viewportY||0,this.viewportW=t.viewportW||this.width,this.viewportH=t.viewportH||this.height,this.triggers=t.triggers||{},this.windows=t.windows||{},this.maxWinX=this.width/this.viewportW|0,this.xMax=this.width-this.viewportW,this.yMax=this.height-this.viewportH,this.viewportTargetX=this.viewportTargetY=this.viewportSpeedX=this.viewsportSpeedY=this.viewportStartX=this.viewportStartY=0,this.viewportLimitX=230,this.viewportCenterX=307,this.viewportLimitY=154,this.viewportCenterY=230,this.tileOffsetX=0,this.tileOffsetY=0,this.scrollTileWidth=0,this.scrollTileHeight=0,this.viewportLimits={x1:this.viewportLimitX,x2:this.viewportW-this.viewportLimitX,y1:this.viewportLimitY,y2:this.viewportH-this.viewportLimitY},this.objects=[],this.friendBullets=[],this.enemies=[],this.platforms=[],this.name=t.name||"map"+(new Date).getTime(),this._calcNumTiles(!1),this.setBuffer(t.buffer),this.dataUrl=t.dataUrl,this.firstRow=this.lastRow=this.firstCol=this.lastCol=0,this.isDebug=!1,this.srcBitmap=null,this.moving=!1,this.setEasing(t.easing),this.startMoveTime=null,this.duration=800,this.masterObject=null,this.currentWindow=null,this.startX=t.startX||0,this.startY=t.startY||0,window.maps[this.name]=this,this.mapEvent=new h.a(this),this.scene=null,this.isDirty=!0}return u(e,[{key:"setStartXYFromMaster",value:function(){this.startX=this.masterObject.x,this.startY=this.masterObject.y}},{key:"setEasing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"linear";this.easing=a.a.getEasing(e)}},{key:"respawn",value:function(){console.log("avant",this.masterObject.running,this.masterObject.currentAnimName),this.masterObject.reset(),console.log("apres",this.masterObject.running,this.masterObject.currentAnimName),console.log("resuming",this.startX,this.startY),this.masterObject.x=this.startX,this.masterObject.y=this.startY,this.isDirty=!0}},{key:"reset",value:function(){this.masterObject=null,this.objects.length=0,this.friendBullets.length=0,this.enemies.length=0,this.platforms.length=0;for(var e in this.windows)this.windows[e].displayed=!1;for(var t in this.triggers)this.triggers[t].triggered=!1;this.mapEvent.reset(),this.viewportX=this.options.viewportX||0,this.viewportY=this.options.viewportY||0,this.viewportW=this.options.viewportW||0,this.viewportH=this.options.viewportH||0,this.tileOffsetX=0,this.tileOffsetY=0,this.scrollTileWidth=0,this.scrollTileHeight=0,this.firstCol=-this.viewportX/this.tileWidth,this.firstRow=-this.viewportY/this.tileHeight,this.lastCol=this.firstCol+this.numViewportCols,this.lastRow=this.firstRow+this.numViewportRows,this.startX=this.options.startX||0,this.startY=this.options.startY||0,this.isDirty=!0}},{key:"setScene",value:function(e){this.scene=e}},{key:"setBuffer",value:function(e){var t=this.numCols*this.numRows;this.map=new Uint8Array(e,0,t),this.tileBehaviors=new Uint8Array(e,t),this.buffer=e}},{key:"setData",value:function(e,t){var i=this.numCols*this.numRows,n=new Uint8Array(2*i);n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),i),this.buffer=n.buffer,this.map=new Uint8Array(this.buffer,0,i),this.tileBehaviors=new Uint8Array(this.buffer,i,i)}},{key:"setMasterObject",value:function(e){this.masterObject=e,e.x=this.startX,e.y=this.startY}},{key:"addObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!e.image&&e.imageId&&e.setImage(r.a.getResourceById(e.imageId)),e.setMap(this),e.setScene(this.scene),e.layer=t,this.objects.push(e),!0===e.master&&this.setMasterObject(e),1===e.collideGroup?this.enemies.push(e):2===e.collideGroup?this.friendBullets.push(e):3===e.collideGroup&&(console.log("[Map] adding platform "+e.id),this.platforms.push(e))}},{key:"setTilesSize",value:function(e,t){this.tileWidth=e,this.tileHeight=t}},{key:"setViewPort",value:function(e,t,i,n){this.viewportX=e,this.viewportY=t,this.viewportW=i,this.viewportH=n}},{key:"debug",value:function(e){this.isDebug=e,this.isDirty=!0}},{key:"moveObjects",value:function(e){this.objects.forEach(function(t){3!==t.collideGroup&&t.movable&&t.update(e)})}},{key:"movePlatforms",value:function(e){this.platforms.forEach(function(t){t.movable&&t.update(e)})}},{key:"update",value:function(e){var t=0,i=0,n=0;!0===this.moving?(t=e-this.startMoveTime,i=t/this.duration,t>=this.duration?(this.moving=!1,this.viewportX=this.viewportTargetX,this.viewportY=this.viewportTargetY):(n=this.easing(i,t,0,1,this.duration),this.viewportX=this.viewportStartX+n*this.viewportSpeedX|0,this.viewportY=this.viewportStartY+n*this.viewportSpeedY|0),this.isDirty=!0):this.masterObject&&(this.checkMasterPosition(),this.checkForTriggers()),this.movePlatforms(e),this.moveObjects(e)}},{key:"checkMasterPosition",value:function(){var e=null,t=null;this.masterObject&&!this.moving&&(this.viewportX&&this.masterObject.x+this.viewportX<=this.viewportLimitX?e=this.viewportX+this.viewportCenterX:-this.viewportX+this.viewportW-this.masterObject.x<=this.viewportLimitX&&(e=this.viewportX-this.viewportCenterX),this.viewportY&&this.masterObject.y+this.viewportY<=this.viewportLimitY?t=this.viewportY+this.viewportCenterY:-this.viewportY+this.viewportH-this.masterObject.y<=this.viewportLimitY&&(t=this.viewportY-this.viewportCenterY),null===e&&null===t||this.moveTo(null!==e?e:this.viewportX,null!==t?t:this.viewportY),null===e&&null===t||this.moveTo(null!==e?e:this.viewportX,null!==t?t:this.viewportY))}},{key:"checkCollisions",value:function(){this.masterObject&&this.masterObject.canCollide&&this.checkMasterToEnemiesCollisions(),this.checkMasterBulletsToEnemiesCollisions()}},{key:"checkForTriggers",value:function(){var e=this,t=this.masterObject.getHitBox();this.getTriggersForBox(this.masterObject.x+t.x,this.masterObject.y+t.y,this.masterObject.x+t.x2,this.masterObject.y+t.y2).forEach(function(t){t.triggered=!e.mapEvent.handleEvent(t)})}},{key:"moveTo",value:function(e,t){var i=e<-this.xMax?-this.xMax:e,n=t<-this.yMax?-this.yMax:t;this.moving||this.viewportX===i&&this.viewportY===n||(this.masterObject&&this.masterObject.savePosition(),this.viewportTargetX=i>0?0:i,this.viewportTargetY=n>0?0:n,this.startMoveTime=(new Date).getTime(),this.viewportSpeedX=i-this.viewportX|0,this.viewportSpeedY=n-this.viewportY|0,this.viewportStartX=this.viewportX,this.viewportStartY=this.viewportY,this.moving=!0)}},{key:"setNewSrc",value:function(e){this.src=e.src}},{key:"getSrc",value:function(){return this.src}},{key:"fallTest",value:function(e,t){var i=this.getTileIndexFromPixel(e,t);return this.tileBehaviors[i.x+i.y*this.numCols]===s.a.TYPE.WALL}},{key:"checkMasterBulletsToEnemiesCollisions",value:function(){var e=0,t=0,i=this.friendBullets.length,n=this.enemies.length;for(e=0;e<i;++e)for(t=0;t<n;++t)this.enemies[t]&&this.enemies[t].canCollideFriendBullet&&this.friendBullets[e]&&this.friendBullets[e].hitTest(this.enemies[t])}},{key:"checkMasterToEnemiesCollisions",value:function(){for(var e=0,t=this.enemies.length,i=!1;e<t&&!i;)i=this.enemies[e].hitTest(this.masterObject),e++;return i}},{key:"checkForPlatform",value:function(e,t,i){var n=e.getHitBox();n.x,sprite.x,n.y,sprite.y;return this.platforms.forEach(function(e){var t=e.getHitBox();e.x,t.x,e.y,t.y}),!1}},{key:"getTriggersForBox",value:function(e,t,i,n){var s=this.getTileIndexFromPixel(e,t),r=this.getTileIndexFromPixel(i,t),o=this.getTileIndexFromPixel(e,n),a=r.x,h=o.y,u=void 0,l=void 0,c=[],f=null;for(u=s.x;u<=a;u++)for(l=s.y;l<=h;l++)(f=this.triggers[l*this.numCols+u])&&!f.triggered&&c.push(f);return c}},{key:"checkMatrixForCollision",value:function(e,t,i,n,s){var r=t/this.tileWidth,o=e.length/r,a=0,h=0,u=!1;for(a=0;a<o;++a)for(h=0;h<r;++h)u=u||e[a*r+h]&&this.getTileBehaviorAtIndex(i+h,n+a)===s;return u}},{key:"getMaxDistanceToTile",value:function(e,t,i){for(var n=!1,s=e.getHitBox2(),r=t<0,o=r?-this.tileWidth:this.tileWidth,a=r?-1:1,h=this.getTileIndexFromPixel(r?s.x+a:s.x2+a,s.y),u=h.y,l=u+Math.floor((s.y2-s.y)/this.tileHeight),c=0;!n&&Math.abs(a)<Math.abs(t);){for(c=u;c<=l;++c)n=n||this.getTileBehaviorAtIndex(h.x,c)===i;n||(a+=o,h=this.getTileIndexFromPixel(r?s.x+a:s.x2+a,s.y))}return n?Math.abs(a)>1?a-o:0:t}},{key:"setNextX",value:function(e,t){for(var i=!(e.vx>0),n=e.getHitBox(),s=e.y+n.y2,r=i?e.x+n.x-1:e.x+n.x2+1,o=e.y+n.y,a=this.getTileIndexFromPixel(r,o),h=!1,u=i?r:0;!h&&(i&&u>=e.vx||!i&&u<=e.vx);){for(var l=a.y*this.tileHeight;l<s;l+=this.tileHeight,a.y++)if(this.tileBehaviors[a.y*this.numCols+a.x]===t){h=!0;break}h||(u=i?a.x*this.tileWidth-r:++a.x*this.tileWidth-r),r=i?a.x*this.tileWidth-1:a.x*this.tileWidth,a=this.getTileIndexFromPixel(r,o)}return i&&e.vx>=u||!i&&e.vx<u?(e.x+=e.vx,!1):(console.log("**collision"),e.x+=u,!0)}},{key:"setNextYTop",value:function(e,t){var i=e.getHitBox,n=(e.x,i.x2,e.x+i.x),s=e.y+i.x2+1;this.getTileIndexFromPixel(n,s);e.y+=e.vy}},{key:"checkForTileType",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=e.getHitBox(),o=this.hitObjectTest(r.x+e.x+i,r.y+e.y+n,r.x2+e.x-i,r.y2+e.y-n,t);return!!o&&(s&&e.centerXOverTile(o),!0)}},{key:"hitObjectTest",value:function(e,t,i,n,s){var r=this.getTileIndexFromPixel(e,t),o=this.getTileIndexFromPixel(i,t),a=this.getTileIndexFromPixel(e,n),h=o.x,u=a.y,l=void 0,c=void 0;for(l=r.x;l<=h;l++)for(c=r.y;c<=u;c++)if(this.tileBehaviors[c*this.numCols+l]===s)return{x:l,y:c,tile:{x:l*this.tileWidth,y:c*this.tileHeight}};return!1}},{key:"drawTile",value:function(e,t,i,n,s,r){var o=this.tiles[e];t.drawImage(this.srcBitmap,o.offsetX+(s&&this.tileOffsetX)||0,o.offsetY+(r&&this.tileOffsetY)||0,s?this.scrollTileWidth:o.width,r?this.scrollTileHeight:o.height,i,n,s?this.scrollTileWidth:o.width,r?this.scrollTileHeight:o.height)}},{key:"_getTileOffset",value:function(){var e=Math.abs(this.viewportX),t=Math.abs(this.viewportY);this.tileOffsetX=e<this.tileWidth?e:e%this.tileWidth,this.tileOffsetY=t<this.tileHeight?t:t%this.tileHeight,this.scrollTileWidth=this.tileWidth-this.tileOffsetX,this.scrollTileHeight=this.tileHeight-this.tileOffsetY}},{key:"draw",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=void 0,o=void 0,a=void 0,h=void 0,u=0,l=0,c=0;if(!this.tiles.length)return void(this.isDirty=!1);if(!this.srcBitmap&&(this.srcBitmap=r.a.getResourceById(this.src),!this.srcBitmap))throw"no source bitmap found when drawing map";if(s=o=a=h=0,!this.isDirty&&this.lastCol||this._getBoundariesTiles(t),this.isDirty||!this.lastCol){for(this._getTileOffset(),s=this.firstRow,a=this.lastRow,c=n;s<a;s++){for(o=this.firstCol,h=this.lastCol,l=i;o<h;o++)u=this.map[s*this.numCols+o],u<255&&this.drawTile(u,e,l,c,!(!this.viewportX||o!==this.firstCol),!(!this.viewportY||s!==this.firstRow)),this.viewportX&&o===this.firstCol?l+=this.scrollTileWidth:l+=this.tileWidth;this.viewportY&&s===this.firstRow?c+=this.scrollTileHeight:c+=this.tileHeight}!0===this.isDebug&&this.showTileBehaviors(e,t,i,n),this.checkVisibleWindows(),this.isDirty=!1}}},{key:"addNewObjectsFromWindow",value:function(e){var t=this,i=this.windows[e];i&&!1===i.displayed&&(i.displayed=!0,i.items.forEach(function(e){var i=r.a.newResourceFromPool(e.type,e.spriteOptions);t.addObject(i),e.itemId&&t.mapEvent.addItem(e.itemId,i)}))}},{key:"checkVisibleWindows",value:function(){for(var e=Math.abs(this.viewportY)/this.viewportH*this.maxWinX|0,t=this.viewportY%this.viewportH?e+this.maxWinX:e,i=this.viewportX%this.viewportW,n=e;n<=t;n+=this.maxWinX)this.addNewObjectsFromWindow(n),i&&this.addNewObjectsFromWindow(n+1)}},{key:"drawObjects",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=void 0,r=void 0,o=this.objects.length,a=this.objects,h=null,u=null;for(s=o-1;s>=0;s--)!function(){h=a[s];var o=h.layer;if((i||n)&&(h.x+=i,h.y+=n,h.children.length))for(r=0;r<h.children.length;++r)u=h.children[r],u.x+=i,u.y+=n;if(h._draw(e[o]),t.isDebug&&h.showHitBox(e[o]),h.children.length&&h.children.forEach(function(i){i._draw(e[o]),t.isDebug&&i.showHitBox(e[o])}),(i||n)&&(h.x-=i,h.y-=n,h.children.length))for(r=0;r<h.children.length;++r)u=h.children[r],u.x-=i,u.y-=n}()}},{key:"getTileAt",value:function(e,t){var i=void 0,n=void 0,s=void 0;return i=e/this.tileWidth|0,n=t/this.tileHeight|0,s=this.map[this.numCols*n+i],this.tiles[s]}},{key:"getTileBehaviorAtIndex",value:function(e,t){return this.tileBehaviors[this.numCols*t+e]}},{key:"getTileIndexFromPixel",value:function(e,t){var i=void 0,n=void 0;return i=e/this.tileWidth|0,n=t/this.tileHeight|0,{x:i,y:n}}},{key:"getTilePixelPos",value:function(e,t){return{y:t*this.tileHeight,x:e*this.tileWidth}}},{key:"_calcNumTiles",value:function(){this.numCols=this.width/this.tileWidth|0,this.numRows=this.height/this.tileHeight|0,this.numViewportCols=Math.ceil(this.viewportW/this.tileWidth),this.numViewportRows=Math.ceil(this.viewportH/this.tileHeight)}},{key:"_getBoundariesTiles",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(this.firstCol=0,this.firstRow=0,this.lastCol=this.width/this.tileWidth|0,this.lastRow=this.height/this.tileHeight|0):(this.firstCol=Math.floor(-this.viewportX/this.tileWidth),this.firstRow=Math.floor(-this.viewportY/this.tileHeight),this.lastCol=this.firstCol+this.numViewportCols,this.lastRow=this.firstRow+this.numViewportRows,this.viewportX%this.tileWidth&&this.lastCol++,this.viewportY%this.tileHeight&&this.lastRow++)}},{key:"notify",value:function(e,t){o.a.notify(e,t)}},{key:"removeObject",value:function(e){var t=this.objects.indexOf(e);t>-1&&this.objects.splice(t,1),t=this.enemies.indexOf(e),t>-1?this.enemies.splice(t,1):(t=this.friendBullets.indexOf(e))>-1&&this.friendBullets.splice(t,1)}},{key:"showTileBehaviors",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=void 0,r=void 0,o=void 0,a=void 0,h=0,u=0,l=[null,null,"rgba(240,0,0,.6)","rgba(0,0,240,.6)"],c=void 0,f=void 0;for(s=r=o=a=0,s=this.firstRow,o=this.lastRow,u=n;s<o;s++){for(r=this.firstCol,a=this.lastCol,h=i;r<a;r++)c=this.viewportX&&r===this.firstCol?this.scrollTileWidth:this.tileWidth,f=this.viewportY&&s===this.firstRow?this.scrollTileHeight:this.tileHeight,this.tileBehaviors[s*this.numCols+r]>1&&(e.fillStyle=l[this.tileBehaviors[s*this.numCols+r]],e.beginPath(),e.moveTo(h,u),e.lineTo(h+c,u),e.lineTo(h+c,u+f),e.lineTo(h,u+f),e.lineTo(h,u),e.closePath(),e.fill()),this.viewportX&&r===this.firstCol?h+=this.scrollTileWidth:h+=this.tileWidth;this.viewportY&&s===this.firstRow?u+=this.scrollTileHeight:u+=this.tileHeight}}},{key:"getObjectsList",value:function(){this.objects.forEach(function(e,t){console.log("["+t+"]",e.type,"("+e.id+")")})}},{key:"toString",value:function(){var e=0,t=this.tiles.length,i={src:this.src,viewportX:0,viewportY:0,viewportW:this.viewportW,viewportH:this.viewportH,width:this.width,height:this.height,tileWidth:this.tileWidth,tileHeight:this.tileHeight,map:this.map,objects:this.objects,tiles:[]};for(e=0;e<t;e++)i.tiles.push("new Tile({offsetX: tile.offsetX,offsetY: tile.offsetY,width: tile.width,height: tile.height,inertia: tile.inertia,upCollide: tile.upCollide,downCollide: tile.downCollide}),");return JSON.stringify(i)}},{key:"_createTiles",value:function(e){var t=[];return e.forEach(function(e){t.push(new s.a(e))}),t}},{key:"addTileSet",value:function(e){e&&e.length?this.tiles=this._createTiles(e):this.tiles=[],this.isDirty=!0}},{key:"clear",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.a.TYPE.AIR,i=0;i<this.numCols;++i)for(var n=0;n<this.numRows;++n)this.map[n*this.numCols+i]=e,this.tileBehaviors[n*this.numCols+i]=t}},{key:"updateTile",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=t*this.numCols+e;i>-1&&(this.map[s]=i,this.isDirty=!0),n>-1&&(this.isDirty=!0,this.tileBehaviors[s]=n)}},{key:"shift",value:function(e,t,i){var n=new Uint8Array(this.buffer,0,e*this.numCols),s=new Uint8Array(this.buffer,this.numCols*this.numRows,e*this.numCols),r=t*this.numCols;this.map.set(n,r),this.tileBehaviors.set(s,r),this.isDirty=!0}},{key:"resize",value:function(e,t){var i=null,n={},s={},r=new Array(this.numCols*this.numRows),o=null,a=null,h=null;if("bottomleft"!==e)throw"resize not supported for direction"+e;var u=(t.newWidth,this.width,t.newHeight-this.height),l=t.newWidth/this.tileWidth|0,c=t.newHeight/this.tileHeight|0,f=(this.numCols,c-this.numRows),d=this.width/this.viewportW|0,p=this.height/this.viewportH|0,v=(t.newWidth,this.viewportW,t.newHeight/this.viewportH|0),y=v-p;i=new ArrayBuffer(l*c*2),o=new Uint8Array(i,0,c*l),r=new Uint8Array(i,c*l,c*l);for(var m=f;m<c;m++)for(var g=0;g<this.numCols;g++)o[m*l+g]=this.map[m*l+g],r[m*l+g]=this.tileBehaviors[m*l+g],this.triggers[m*l+g]&&(a=Object.assign({},!0,this.triggers[m*l+g]),a.spriteOptions&&(a.spriteOptions.y+=u),n[m*l+g]=a);this.setBuffer(i),this.width=t.newWidth,this.height=t.newHeight,this.triggers=n,this._calcNumTiles();for(var b=y;b<v;++b)for(var w=0;w<d;++w)if(this.windows[b*d+w]){h=this.windows[b*d+w].items;for(var k=0;k<h.length;++k)a=Object.assign({},h[k]),a.spriteOptions&&(a.spriteOptions.y+=u);s[b*d+w]={displayed:!1,items:h.slice(0)}}this.windows=s}}]),e}();t.a=l},/*!****************************!*\
  !*** ./js/Map/MapEvent.js ***!
  \****************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../Resource/ResourceManager */5),r=i(/*! ../Drawable/Wave */14),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),console.log("[MapEvent] constructor()"),this.map=t||null,this.reset()}return o(e,[{key:"reset",value:function(){this.switches={},this.events=[],this.items={}}},{key:"addItem",value:function(e,t){this.items[e]=t}},{key:"getItem",value:function(e){return this.items[e]}},{key:"setSwitch",value:function(e,t){this.switches[e]=t}},{key:"toggleSwitch",value:function(e){this.setSwitch(e,void 0===this.switches[e]||!this.switches[e])}},{key:"getSwitch",value:function(e){return this.switches[e]||!1}},{key:"checkConditions",value:function(e){var t,i,n=e.conditions,s=null,r=!0;if(n){for(t=0,i=n.length;t<i;t++){switch(s=n[t],s.type){case"time":break;case"switch":r=this.getSwitch(s.id)===s.status}if(!r)break}return r}return!0}},{key:"handleAction",value:function(e){var t;switch(e.type){case"toggleSwitch":t=e.sprite,t.toggleSwitch(),this.toggleSwitch(t.id);break;default:console.log("[MapEvent] non-handled action type",e.type)}}},{key:"handleEvent",value:function(e){var t=e.type,i=null;if(!this.checkConditions(e))return!0;switch(t){case"cp":this.map.setStartXYFromMaster();break;case"message":this.map.notify("game:message",{message:e.message});break;case"wave":return this.handleWave(Object.assign({},e));case"explosion":this.scheduleSprite(e.spriteId,e.spriteOptions,0),i=this.getItem(e.targetId),i.destroy();break;default:console.log("non-handled Event",e.type)}}},{key:"scheduleSprite",value:function(e,t,i){var n=this,r=s.a.newResourceFromPool(e,t);return i?setTimeout(function(){n.map.addObject(r)},i):this.map.addObject(r),r}},{key:"handleWave",value:function(e){var t=e.size,i=new r.a(e),n=0,s=0;for(e.spriteOptions.wave=i,n=0;n<t;n++)this.scheduleSprite(e.spriteId,e.spriteOptions,s),s+=e.delay||0;return!1}},{key:"endWave",value:function(){}},{key:"triggerEvent",value:function(e){this.events.push(e)}},{key:"isEventTriggered",value:function(e){return this.events.indexOf(e)>-1}}]),e}();t.a=a},/*!***************************!*\
  !*** ./js/Util/Binary.js ***!
  \***************************/
function(e,t,i){"use strict";var n=i(/*! es6-promise */19),s=i.n(n),r={sendArrayBufferView:function(e,t){var i=new XMLHttpRequest;i.open("POST",t,!0),i.send(e)},getArrayBuffer:function(e){return new s.a(function(t,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){var e=n.response;e?t(e):i(!1)},n.send(null)})}};t.a=r},/*!*************************!*\
  !*** ./js/Util/Pool.js ***!
  \*************************/
function(e,t,i){"use strict";var n={create:function(e,t){e._pool=[],e._poolMarker=0,e._poolSize=0;var i=e._pool;e.createFromPool=function(){e._poolSize<=e._poolMarker&&e.expandPool(10);var t=e._pool[e._poolMarker++];return t._poolIndex=e._poolMarker-1,e.prototype.constructor.apply(t,arguments),t},e.expandPool=function(t){for(var n={pool:!0},s=i.length,r=i.length+t;s<r;s++)i.push(new e(n));e._poolSize+=t},e.prototype.freeFromPool=function(){e._poolMarker>0&&e._poolMarker--;var t=i[e._poolMarker],n=t._poolIndex;i[e._poolMarker]=this,i[this._poolIndex]=t,t._poolIndex=this._poolIndex,this._poolIndex=n},e.expandPool(t)}};t.a=n},/*!*******************************************!*\
  !*** ./~/es6-promise/dist/es6-promise.js ***!
  \*******************************************/
function(e,t,i){(function(t,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.0
 */
!function(t,i){e.exports=i()}(0,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return"function"==typeof e}function r(e){q=e}function o(e){V=e}function a(){return void 0!==X?function(){X(u)}:h()}function h(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<W;e+=2){(0,Z[e])(Z[e+1]),Z[e]=void 0,Z[e+1]=void 0}W=0}function l(e,t){var i=arguments,n=this,s=new this.constructor(f);void 0===s[ee]&&A(s);var r=n._state;return r?function(){var e=i[r-1];V(function(){return C(r,s,e,n._result)})}():T(n,s,e,t),s}function c(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(f);return w(i,e),i}function f(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function v(e){try{return e.then}catch(e){return se.error=e,se}}function y(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}function m(e,t,i){V(function(e){var n=!1,s=y(i,t,function(i){n||(n=!0,t!==i?w(e,i):x(e,i))},function(t){n||(n=!0,_(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&s&&(n=!0,_(e,s))},e)}function g(e,t){t._state===ie?x(e,t._result):t._state===ne?_(e,t._result):T(t,void 0,function(t){return w(e,t)},function(t){return _(e,t)})}function b(e,t,i){t.constructor===e.constructor&&i===l&&t.constructor.resolve===c?g(e,t):i===se?(_(e,se.error),se.error=null):void 0===i?x(e,t):s(i)?m(e,t,i):x(e,t)}function w(t,i){t===i?_(t,d()):e(i)?b(t,i,v(i)):x(t,i)}function k(e){e._onerror&&e._onerror(e._result),O(e)}function x(e,t){e._state===te&&(e._result=t,e._state=ie,0!==e._subscribers.length&&V(O,e))}function _(e,t){e._state===te&&(e._state=ne,e._result=t,V(k,e))}function T(e,t,i,n){var s=e._subscribers,r=s.length;e._onerror=null,s[r]=t,s[r+ie]=i,s[r+ne]=n,0===r&&e._state&&V(O,e)}function O(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n=void 0,s=void 0,r=e._result,o=0;o<t.length;o+=3)n=t[o],s=t[o+i],n?C(i,n,s,r):s(r);e._subscribers.length=0}}function S(){this.error=null}function E(e,t){try{return e(t)}catch(e){return re.error=e,re}}function C(e,t,i,n){var r=s(i),o=void 0,a=void 0,h=void 0,u=void 0;if(r){if(o=E(i,n),o===re?(u=!0,a=o.error,o.error=null):h=!0,t===o)return void _(t,p())}else o=n,h=!0;t._state!==te||(r&&h?w(t,o):u?_(t,a):e===ie?x(t,o):e===ne&&_(t,o))}function M(e,t){try{t(function(t){w(e,t)},function(t){_(e,t)})}catch(t){_(e,t)}}function P(){return oe++}function A(e){e[ee]=oe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function j(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[ee]||A(this.promise),H(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):_(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function L(e){return new j(this,e).promise}function R(e){var t=this;return new t(H(e)?function(i,n){for(var s=e.length,r=0;r<s;r++)t.resolve(e[r]).then(i,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function D(e){var t=this,i=new t(f);return _(i,e),i}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Y(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(e){this[ee]=P(),this._result=this._state=void 0,this._subscribers=[],f!==e&&("function"!=typeof e&&I(),this instanceof N?M(this,e):Y())}function B(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=N}var G=void 0;G=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=G,W=0,X=void 0,q=void 0,V=function(e,t){Z[W]=e,Z[W+1]=t,2===(W+=2)&&(q?q(u):$())},U="undefined"!=typeof window?window:void 0,K=U||{},z=K.MutationObserver||K.WebKitMutationObserver,J="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),Q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3),$=void 0;$=J?function(){return function(){return t.nextTick(u)}}():z?function(){var e=0,t=new z(u),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():Q?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}():void 0===U?function(){try{var e=i(/*! vertx */44);return X=e.runOnLoop||e.runOnContext,a()}catch(e){return h()}}():h();var ee=Math.random().toString(36).substring(16),te=void 0,ie=1,ne=2,se=new S,re=new S,oe=0;return j.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===te&&i<e;i++)this._eachEntry(t[i],i)},j.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===c){var s=v(e);if(s===l&&e._state!==te)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(i===N){var r=new i(f);b(r,e,s),this._willSettleAt(r,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},j.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===te&&(this._remaining--,e===ne?_(n,i):this._result[t]=i),0===this._remaining&&x(n,this._result)},j.prototype._willSettleAt=function(e,t){var i=this;T(e,void 0,function(e){return i._settledAt(ie,t,e)},function(e){return i._settledAt(ne,t,e)})},N.all=L,N.race=R,N.resolve=c,N.reject=D,N._setScheduler=r,N._setAsap=o,N._asap=V,N.prototype={constructor:N,then:l,catch:function(e){return this.then(null,e)}},N.polyfill=B,N.Promise=N,N})}).call(t,i(/*! ./../../process/browser.js */41),i(/*! ./../../webpack/buildin/global.js */43))},/*!*****************************!*\
  !*** ./js/athena-module.js ***!
  \*****************************/
function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(/*! ./Game/Game */38);i.d(t,"Game",function(){return n.a});var s=i(/*! ./Util/Pool */18);i.d(t,"Pool",function(){return s.a});var r=i(/*! ./Scene/Scene */39);i.d(t,"Scene",function(){return r.a});var o=i(/*! ./Resource/ResourceManager */5);i.d(t,"ResourceManager",function(){return o.a});var a=i(/*! ./Drawable/Drawable */2);i.d(t,"Drawable",function(){return a.a});var h=i(/*! ./Drawable/Sprite */32);i.d(t,"Sprite",function(){return h.a});var u=i(/*! ./Drawable/SimpleText */13);i.d(t,"SimpleText",function(){return u.a});var l=i(/*! ./Drawable/Wave */14);i.d(t,"Wave",function(){return l.a});var c=i(/*! ./Drawable/Menu */30);i.d(t,"Menu",function(){return c.a});var f=i(/*! ./Drawable/Hud */29);i.d(t,"Hud",function(){return f.a});var d=i(/*! ./Drawable/BitmapText */28);i.d(t,"BitmapText",function(){return d.a});var p=i(/*! ./Drawable/Paint */31);i.d(t,"Paint",function(){return p.a});var v=i(/*! ./Drawable/Behavior/Behavior */1);i.d(t,"Behavior",function(){return v.a});var y=i(/*! ./Notification/NotificationManager */9);i.d(t,"NotificationManager",function(){return y.a});var m=i(/*! ./Map/Map */15);i.d(t,"Map",function(){return m.a});var g=i(/*! ./Map/Tile */4);i.d(t,"Tile",function(){return g.a});var b=i(/*! ./Map/MapEvent */16);i.d(t,"MapEvent",function(){return b.a});var w=i(/*! ./FX/FX */3);i.d(t,"FX",function(){return w.a});var k=i(/*! ./FX/Effect/Effect */8);i.d(t,"Effect",function(){return k.a});var x=i(/*! ./FX/Easing/Easing */33);i.d(t,"Easing",function(){return x.a});var _=i(/*! ./Input/InputManager */10);i.d(t,"InputManager",function(){return _.a});var T=i(/*! ./Display/DisplayManager */12);i.d(t,"DisplayManager",function(){return T.a});var O=i(/*! ./Display/Display */11);i.d(t,"Display",function(){return O.a});var S=i(/*! ./Audio/AudioManager */7);i.d(t,"AudioManager",function(){return S.a});var E=i(/*! ./Util/Binary */17);i.d(t,"Binary",function(){return E.a});var C=i(/*! ./Util/Dom */6);i.d(t,"Dom",function(){return C.a});var M=i(/*! ./Util/Deferred */0);i.d(t,"Deferred",function(){return M.a})},/*!*******************************************!*\
  !*** ./js/Drawable/Behavior/Behaviors.js ***!
  \*******************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ./GroundMove */22),r=i(/*! ./SimpleFall */26),o=i(/*! ./PlayerMove */25),a=i(/*! ./InOut */23),h=i(/*! ./Path */24),u=i(/*! ./WeaponMove */27),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c={},f=function(){function e(){n(this,e)}return l(e,[{key:"addBehavior",value:function(e,t){c[e]=t}},{key:"getBehavior",value:function(e){return c[e]}}]),e}(),d=new f;d.addBehavior("ground",s.a),d.addBehavior("inout",a.a),d.addBehavior("simplefall",r.a),d.addBehavior("weapon",u.a),d.addBehavior("player",o.a),d.addBehavior("path",h.a),t.a=d},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/GroundMove.js ***!
  \********************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.direction=i.direction||"right",r.direction.match("left")&&(r.sprite.vx=-r.sprite.vx),r.direction.match("top")&&(r.sprite.vy=-r.sprite.vy),r}return r(t,e),h(t,[{key:"onUpdate",value:function(){var e=this.sprite,t=e.currentMap,i=e.x+e.vx,n=e.y+e.vy,s=e.getHitBox(),r=e.vx>0?s.x2:s.x;t.hitObjectTest(i+r,n+s.y,i+r,n+s.y,a.a.TYPE.WALL)?(e.vx=-e.vx,this.onVXChange&&this.onVXChange(e.vx)):t.hitObjectTest(i+s.x,n+s.y2+2,i+s.x2,n+s.y2+2,a.a.TYPE.AIR)?(e.vx=-e.vx,this.onVXChange&&this.onVXChange(e.vx)):t.hitObjectTest(i+s.x,n+s.y2+2,i+s.x2,n+s.y2+2,a.a.TYPE.LADDER)&&(e.vx=-e.vx,this.onVXChange&&this.onVXChange(e.vx)),e.x+=e.vx,e.y+=e.vy}}]),t}(o.a);t.a=u},/*!***************************************!*\
  !*** ./js/Drawable/Behavior/InOut.js ***!
  \***************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Behavior */1),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.startY=e.y,r.startX=e.x,r.maxX=i.minX||0,r.maxY=i.minY||0,r}return r(t,e),a(t,[{key:"onUpdate",value:function(){var e=this.sprite,t=Math.abs(e.y-this.startY),i=Math.abs(e.x-this.startX);t>this.maxY&&(e.vy=-e.vy,this.onVYChange&&this.onVYChange()),i>this.maxX&&(e.vx=-e.vx,this.onVXChange&&this.onVXChange()),e.x+=e.vx,e.y+=e.vy}}]),t}(o.a);t.a=h},/*!**************************************!*\
  !*** ./js/Drawable/Behavior/Path.js ***!
  \**************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){return"number"==typeof e?e?e<0?-1:1:e===e?0:NaN:NaN}var a=i(/*! ./Behavior */1),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.startY=e.y,r.startX=e.x,r.currentNode=0,r.offset=2,r.nodes=i.nodes,r.reverse=i.reverse||!1,r.dirX=0,r.dirY=0,r.numNodes=r.nodes.length/2,r}return r(t,e),h(t,[{key:"onUpdate",value:function(){var e=this.sprite,t=this.currentNode,i=this.nodes[t],n=this.nodes[t+1];if(this.offset>0?(e.x+=i,e.y+=n):(e.x-=i,e.y-=n),i&&(this.dirX&&o(this.dirX)!==o(i)&&this.onVXChange&&this.onVXChange(),this.dirX=i),n&&(this.dirY&&o(this.dirY)!==o(n)&&this.onVYChange&&this.onVYChange(),this.dirY=n),this.currentNode+=this.offset,this.currentNode>=this.nodes.length||this.currentNode<0){if(!this.reverse)return void(e.movable=!1);this.onVXChange&&(this.dirX=0,this.onVXChange()),this.onVYChange&&(this.dirY=0,this.onVYChange()),this.currentNode=this.currentNode<0?0:this.nodes.length-2,this.offset=-this.offset}}}]),t}(a.a);t.a=u},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/PlayerMove.js ***!
  \********************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Audio/AudioManager */7),h=i(/*! ../../Map/Tile */4),u=i(/*! ../../Input/InputManager */10),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.direction=i.direction||"right",r.currentMovement=i.startMovement||"",r.lookDirection=i.lookDirection||"left",r.climbVY=2,r.jumping=!1,r.firing=!1,r.fromLadder=!1,r.sideHit=!1,r}return r(t,e),l(t,[{key:"onUpdate",value:function(){if("falling"===this.currentMovement||this.currentMovement.match(/jump/)||this.firing)this.currentMovement.match(/jump/)?(u.a.isKeyDown("SPACE",!0)&&this.handleFire(),this.fromLadder||!0!==u.a.getKeyStatus(u.a.KEYS.UP)||this.goUpOrClimb(!0),this.jump()):this.currentMovement.match("fire")||this.currentMovement.match("climb")||this.fall();else if(u.a.isKeyDown("CTRL")?(console.log("[PlayerMove] jump:",this.lookDirection),this.startJump(this.lookDirection)):!0===u.a.getKeyStatus(u.a.KEYS.LEFT)?!0===u.a.getKeyStatus(u.a.KEYS.UP)?this.startJump("left"):this.walkLeft():!0===u.a.getKeyStatus(u.a.KEYS.RIGHT)?!0===u.a.getKeyStatus(u.a.KEYS.UP)?(this.startJump("right"),console.log("[PlayerMove] startJump right",this.fromLadder)):this.walkRight():!0===u.a.getKeyStatus(u.a.KEYS.UP)?this.goUpOrClimb(!1):!0===u.a.getKeyStatus(u.a.KEYS.DOWN)?this.goDownOrClimb():"climb"!==this.currentMovement?this.currentMovement.match("fire")||this.idle():this.stopClimbing(),u.a.isKeyDown("SPACE",!0))switch(this.currentMovement){case"faceWall":this.switchAbove&&this.getMapEvent().handleAction({type:"toggleSwitch",sprite:this.switchAbove});break;case"climb":if(!this.lookDirection)break;case"idle":case"walk_right":case"walk_left":this.handleFire();break;case"down":break;default:console.log("[PlayerMove] unhandle fire",this.currentMovement)}}},{key:"handleFire",value:function(){var e=this;console.log("[PlayerMove] fire direction",this.lookDirection),this.firing||this.sprite.onEvent("fire",{direction:this.lookDirection})&&(this.firing=!0,this.previousMovement=this.currentMovement,this.sprite.storeCurrentAnim(),this.sprite.setAnimation("fire"+this.lookDirection,function(){e.firing=!1,this.restorePreviousAnim()}))}},{key:"walk",value:function(e){var t=this.sprite,i=t.getHitBox(),n=void 0,s=void 0,r=void 0;return this.currentMovement="walk_"+e,this.vy=0,t.currentAnimName="walk"+e.charAt(0).toUpperCase()+e.slice(1),r="step_"+e,this.lookDirection=e,this.vx="left"===e?-2:2,n=t.x+this.vx,s=t.y+this.vy,t.currentMap.hitObjectTest(n+i.x,s+i.y,n+i.x2,s+i.y2,h.a.TYPE.WALL)?this.idle():(t.startAnimation(),t.currentFrameNum===t.previousFrameNum||3!==t.currentFrameNum&&7!==t.currentFrameNum||a.a.play(r)),t.x+=this.vx,t.y+=this.vy,this.fallTest(),0}},{key:"walkLeft",value:function(){"climb"!==this.currentMovement?this.walk("left"):this.lookDirection="left"}},{key:"walkRight",value:function(){"climb"!==this.currentMovement?this.walk("right"):this.lookDirection="right"}},{key:"startJump",value:function(e){var t=this.sprite,i=this;this.jumping?(i.readyToJump=!0,this.jumping=!0,i.currentMovement="jump"+e,this.vx="left"===e?-2:2,this.vy=-4,this.gravity=.098,this.sprite.setAnimation("jump"+e)):(console.log("[PlayerMove] starting jump",t.y),this.readyToJump=!1,this.currentMovement="startjump",this.vx="left"===e?-2:2,this.vy=-4,this.gravity=.098,console.log("[PlayerMove] startJump",this.vy),t.setAnimation("goDown"+e,function(){console.log("[PlayerMove] end goDownLeft, ready to jump",this.vy,this.y),i.readyToJump=!0,i.currentMovement="jump"+e,i.jumping=!0,this.setAnimation("jump"+e)})),this.lookDirection=this.direction=e,this.sideHit=!1,a.a.play("jump")}},{key:"jump",value:function(){var e=this.sprite,t=e.x+Math.ceil(this.vx),i=e.y+Math.ceil(this.vy),n=e.getHitBox(),s=null,r=null,o=!1;return this.readyToJump?this.currentMovement.match(/jump/)&&(s=e.currentMap.hitObjectTest(t+n.x,e.y+n.y,t+n.x2,e.y+n.y2,h.a.TYPE.WALL),s&&(this.sideHit=!0,o=!0,"right"===this.direction?e.x=s.tile.x-n.x2-n.x-1:e.x=s.tile.x+e.currentMap.tileWidth),r=e.currentMap.hitObjectTest(e.x+n.x,i+n.y,e.x+n.x2,i+n.y2,h.a.TYPE.WALL))?this.vy<0?(console.log("[PlayerMove] Top collision, reversing vy!"),void(this.sideHit?this.vy=-this.vy:this.fall())):(console.log("[PlayerMove] touch ground!",this.currentMovement),this.jumping=!1,this.fromLadder=!1,a.a.play("land"),this.currentMovement="idle",e.y=r.tile.y-e.getCurrentHeight(),void(this.vy=0)):(o||(e.x+=Math.ceil(this.vx)),e.y+=Math.ceil(this.vy),this.vy+=this.gravity,void 0):void console.log("[PlayerMove] not ready to jump",this.fromLadder)}},{key:"idle",value:function(){var e=this.sprite;this.vx=0,this.vy=0,e.stopAnimation()}},{key:"goDown",value:function(){var e=this.sprite;this.vx=0,this.vy=0,e.currentAnimName="goDown"+this.lookDirection,this.currentMovement=""}},{key:"faceWall",value:function(){var e=this.sprite;this.vx=0,this.vy=0,"faceWall"!==this.currentMovement&&(this.currentMovement="faceWall",e.advanceFrame("faceWall"),this.switchAbove=this.sprite.currentMap.getSwitchAboveMaster())}},{key:"climb",value:function(e){var t=this.sprite;this.fromLadder=!0,this.currentMovement="climb",this.vx=0,this.vy=e?-this.climbVY:this.climbVY,t.currentAnimName="climb",t.startAnimation(),t.x+=this.vx,t.y+=this.vy}},{key:"stopClimbing",value:function(){var e=this.sprite;this.vx=0,this.vy=0,e.stopAnimation()}},{key:"goUpOrClimb",value:function(e){var t=this.sprite,i=t.getHitBox(),n=e?0:24,s=!1;return!0!==u.a.getKeyStatus(u.a.KEYS.LEFT)&&!0!==u.a.getKeyStatus(u.a.KEYS.RIGHT)&&(!0===e?t.currentMap.hitObjectTest(i.x+t.x,i.y+t.y+40,i.x+t.x-n,i.y2+t.y-50,h.a.TYPE.LADDER)&&(s=t.currentMap.hitObjectTest(i.x2+t.x+n,i.y+t.y+40,i.x2+t.x-n,i.y2+t.y-50,h.a.TYPE.LADDER)):s=t.currentMap.hitObjectTest(i.x+t.x+n,i.y+t.y+40,i.x2+t.x-n,i.y2+t.y-50,h.a.TYPE.LADDER),!1!==s?("climb"!==this.currentMovement&&(t.centerXOverTile(s),this.lookDirection=""),this.climb(1),!0):e?void 0:(this.faceWall(),!1))}},{key:"goDownOrClimb",value:function(){var e=this.sprite,t=e.getHitBox(),i=e.currentMap.hitObjectTest(t.x+e.x+24,t.y2+e.y+this.climbVY,t.x2+e.x-24,t.y2+e.y+this.climbVY,h.a.TYPE.LADDER);i?("climb"!==this.currentMovement&&e.centerXOverTile(i),this.climb(0)):"climb"===this.currentMovement||"faceWall"===this.currentMovement?(i=e.currentMap.hitObjectTest(t.x+e.x+24,t.y2+e.y+this.climbVY,t.x2+e.x-24,t.y2+e.y+this.climbVY,h.a.TYPE.LADDER),this.faceWall()):this.goDown()}},{key:"fall",value:function(){var e=4,t=this.sprite;for(this.jumping=!1;e>0;e--)if(this.fallTest(e)){this.vy=e;break}e>0?(this.vx=0,t.y+=this.vy,t.advanceFrame("fall"+this.lookDirection)):this.fromLadder=!1}},{key:"fallTest",value:function(e){e=e||1;var t=this.sprite,i=t.getHitBox(),n=t.y+i.y2+e;return t.currentMap.fallTest(t.x+i.x,n)||t.currentMap.fallTest(t.x+i.x2,n)?("falling"==this.currentMovement&&(this.currentMovement=""),!1):(this.currentMovement="falling",!0)}}]),t}(o.a);t.a=c},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/SimpleFall.js ***!
  \********************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.elasticity=void 0!==i.elasticity?i.elasticity:.8,r.onEnd=i.onEnd||null,r.onGround=i.onGround||null,r}return r(t,e),h(t,[{key:"onUpdate",value:function(){var e=this.sprite,t=e.currentMap,i=e.x+e.vx,n=e.y+e.vy,s=e.getHitBox(),r=null;r=t.hitObjectTest(i+s.x,n+s.y2,i+s.x2,n+s.y2,a.a.TYPE.WALL),r?(this.onGround&&this.onGround(),this.resetY(),Math.abs(e.vy)<=e.gravity&&(e.movable=!1,this.onEnd&&this.onEnd())):(e.vy+=e.gravity,e.y+=e.vy)}},{key:"resetY",value:function(){this.sprite.vy=-this.sprite.vy*this.elasticity}}]),t}(o.a);t.a=u},/*!********************************************!*\
  !*** ./js/Drawable/Behavior/WeaponMove.js ***!
  \********************************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Behavior */1),a=i(/*! ../../Map/Tile */4),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.direction=i.direction||"right",r.direction.match("left")&&(e.vx=-e.vx),r.direction.match("top")&&(e.vy=-e.vy),r}return r(t,e),h(t,[{key:"onUpdate",value:function(){var e=this.sprite,t=e.currentMap,i=e.x+e.vx,n=e.y+e.vy,s=e.getHitBox(),r=e.vx>0?s.x2:s.x;t.hitObjectTest(i+r,n+s.y,i+r,n+s.y2,a.a.TYPE.WALL)&&(e.vx=-e.vx,this.onVXChange&&this.onVXChange(e.vx)),e.x+=e.vx,e.y+=e.vy}}]),t}(o.a);t.a=u},/*!***********************************!*\
  !*** ./js/Drawable/BitmapText.js ***!
  \***********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Drawable */2),a=i(/*! ../FX/FX */3),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BitmapText",i=arguments[1];n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.width=i.width||320,r.height=i.height||18,r.pixelHeight=0,r.easing=a.a.getEasing(i.easing||"linear"),r.imageId=i.imageId||"image not set",r.characters=i.characters||"ABCDEFGHIJKLMNOPQRSTUVWXYZ",i.imageSrc&&(r.imageId=i.imageSrc),r.buffer=null,r.image=null,r.scrolling=!1,r.text=i.text||"BitmapText",r.scrollOffsetX=i.scrollOffsetX||0,r.scrollOffsetY=i.scrollOffsetY||0,r.textArray=[],r.setFontParams(i),r}return r(t,e),h(t,[{key:"createBuffer",value:function(e){var t=this.width,i=this.height;this.buffer=e.getBuffer(t,i)}},{key:"clearBuffer",value:function(){this.currentScene.display.clearScreen(this.buffer)}},{key:"setFontParams",value:function(e){this.lineSpacing=e.lineSpacing||2,this.letterSpacing=e.letterSpacing||2,this.charWidth=e.charWidth||16,this.charHeight=e.charHeight||18,this.maxCharPerLine=Math.floor(this.width/(this.charWidth+this.letterSpacing)),this.maxPixels=this.maxCharPerLine*(this.charWidth+this.letterSpacing),this.offsetX=e.offsetX||this.charWidth,this.startX=e.startX||0,this.startY=e.startY||0}},{key:"_reset",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_reset",this).call(this),this.setTextPosition()}},{key:"getNextLineLength",value:function(e,t){for(var i=0;i<e.length&&e[i]!==t;)i++;return i}},{key:"getLines",value:function(){var e=this.text,t="",i=!1,n=0,s=0;for(this.textArray.length=0;!i;)e=e.replace(/^\n/,""),n=this.getNextLineLength(e,"\n"),n?(t=e.substr(0,n),t.length<=this.maxCharPerLine?e=e.substr(n):(t=e.substr(0,this.maxCharPerLine),e=e.substr(this.maxCharPerLine)),this.textArray.push({text:t,x:"center"===this.align?Math.floor((this.maxPixels-t.length*(this.charWidth+this.letterSpacing))/2):0,y:s}),s+=this.charHeight+this.lineSpacing):i=!0;this.pixelHeight=this.textArray.length*(this.charHeight+this.lineSpacing)}},{key:"scrollFromBottom",value:function(e,t){this.scrollOffsetY=this.height,this.scrollText({callback:t,duration:e,targetOffsetX:0,targetOffsetY:this.height-this.pixelHeight})}},{key:"scrollFromTop",value:function(e,t){this.scrollOffsetY=-this.pixelHeight,this.scrollText({callback:t,duration:e,targetOffsetX:0,targetOffsetY:0})}},{key:"scrollText",value:function(e){this.scrolling||(console.log("starting scrolling"),this.scrolling=!0,this.callback=e.callback&&e.callback.bind(this)||null,this.duration=e.duration||1e4,this.targetOffsetX=e.targetOffsetX,this.targetOffsetY=e.targetOffsetY,this.startX=this.scrollOffsetX,this.startY=this.scrollOffsetY,this.speedX=this.targetOffsetX-this.startX|0,this.speedY=this.targetOffsetY-this.startY|0,this.startMoveTime=(new Date).getTime())}},{key:"setTextPosition",value:function(){}},{key:"update",value:function(){var e=(new Date).getTime(),t=e-this.startMoveTime,i=t/this.duration,n=void 0;!0===this.scrolling&&(t>=this.duration?(this.scrolling=!1,this.scrollOffsetX=this.targetOffsetX,this.scrollOffsetY=this.targetOffsetY,this.callback&&this.callback()):(n=this.easing(i,t,0,1,this.duration),this.scrollOffsetX=this.startX+n*this.speedX|0,this.scrollOffsetY=this.startY+n*this.speedY|0))}},{key:"getCharOffset",value:function(e){var t=this.characters.indexOf(e);return t<0&&(t=this.characters.indexOf(e.toUpperCase())),t*this.offsetX}},{key:"drawLine",value:function(e){var t=e.x,i=e.y,n=0,s=0,r=e.text.length;for(n=0;n<r;++n)32!==e.text[n].charCodeAt(0)&&(s=this.getCharOffset(e.text[n]),s>=0?this.buffer.drawImage(this.image,s,this.startY,this.charWidth,this.charHeight,t,i,this.charWidth,this.charHeight):console.log("[BitmapText] character "+e.text[n]+" not supported")),t+=this.letterSpacing+this.charWidth}},{key:"renderText",value:function(){var e=0,t=0,i=void 0;for(t=this.textArray.length,e=0;e<t;++e)i=this.textArray[e],this.drawLine(i)}},{key:"setText",value:function(e){this.text=e,this.getLines(),this.buffer?this.clearBuffer():this.createBuffer(this.currentScene.display),this.renderText()}},{key:"setImage",value:function(e){if(!e)return void console.warn("[BitmapText] setImage(): image not loaded",this.imageId||this.imageSrc);this.image=e}},{key:"setScene",value:function(e){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setScene",this).call(this,e),this.setText(this.text)}},{key:"draw",value:function(e){var t,i,n=this.width*this.scale,s=this.height*this.scale,r=Math.floor(n/2),o=Math.floor(s/2),a=this.currentMap&&this.currentMap.viewportX||0,h=this.currentMap&&this.currentMap.viewportY||0,u=this.width,l=this.height;this.visible&&this.image&&(this.executeFx(e),this.scrollOffsetY>=0?(t=this.scrollOffsetY,this.height-t,i=0):(t=0,l,i=Math.abs(this.scrollOffsetY)),e.setTransform(this.scale,0,0,this.scale,this.x+a+r,this.y+h+o),e.rotate(this.angle),e.drawImage(this.buffer.canvas,0,i,Math.floor(u),Math.floor(l),Math.floor(-r),Math.floor(-o),Math.floor(n),Math.floor(s)))}}]),t}(o.a);t.a=l},/*!****************************!*\
  !*** ./js/Drawable/Hud.js ***!
  \****************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){n(this,e),this.score=t.score||0,this.alternateScore=t.alternateScore||0,this.energy=t.energy||100,this.$dest=t.target,this.info="",this.inventory={},this.width=t.width||1024,this.height=t.height||64,Object.defineProperty(this,"score",{get:function(){return this.score},set:function(e){this.score=e}})}return s(e,[{key:"drawBackground",value:function(){}},{key:"draw",value:function(){this.drawBackground()}}]),e}();t.a=r},/*!*****************************!*\
  !*** ./js/Drawable/Menu.js ***!
  \*****************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Drawable */2),a=i(/*! ./SimpleText */13),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.title=new a.a(e,{color:i.color||"black",text:i.title||"Menu Title"}),r.color=i.color||"white",r.selectedColor=i.selectedColor||"red",r.menuItems=[],r.selectedItem=i.selectedItem||0,r.selectCallbacks=[],r.hoverCallbacks=[],r.itemHeight=i.itemHeight||40,r.title.moveTo(r.x,r.y),r.addMenuItems(i.menuItems||[]),r}return r(t,e),h(t,[{key:"addMenuItem",value:function(e){var t=this.y+(this.menuItems.length+1)*this.itemHeight,i=new a.a("menuItem"+this.menuItems.length,e);i.moveTo(this.x,t),i.visible=!0===e.visible||!1,i.selectable=!0===e.selectable||!1,this.menuItems.push(i)}},{key:"addMenuItems",value:function(e){var t=this;console.log("[Menu] addMenuItems()",e),e.forEach(function(e,i){t.addMenuItem(e),e.active&&(t.selectedItem=i)})}},{key:"nextItem",value:function(){++this.selectedItem>=this.menuItems.length&&(this.selectedItem=0),this.selectedItem&&this.menuItems[this.selectedItem]&&!this.menuItems[this.selectedItem].selectable&&this.nextItem()}},{key:"getSelectedItemIndex",value:function(){return this.selectedItem}},{key:"getSelectedItem",value:function(){return this.menuItems[this.selectedItem]}},{key:"setText",value:function(e,t){this.menuItems[e]=t}},{key:"draw",value:function(e){var t=this;0!==this.angle&&(e.save(),e.rotate(this.angle)),this.title.draw(e),this.menuItems.forEach(function(i,n){n===t.selectedItem?i.color=t.selectedColor||"blue":i.color=t.color,i.draw(e)}),0!==this.angle&&e.restore()}}]),t}(o.a);t.a=u},/*!******************************!*\
  !*** ./js/Drawable/Paint.js ***!
  \******************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Drawable */2),a=i(/*! ../Util/Deferred */0),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},l=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.width=i.width||0,r.height=i.height||0,r.x=i.x||0,r.y=i.y||0,r.color=i.color||"red",r}return r(t,e),h(t,[{key:"draw",value:function(e){this.ctx=e,e.setTransform(1,0,0,1,0,0),this._applyMask(e,this.x,this.y),this.isFxQueueEmpty()||this.executeFx(e),this.render(),this._undoMask()}},{key:"render",value:function(){}},{key:"fill",value:function(e){this.ctx.fillStyle=e||this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height)}},{key:"rect",value:function(e,t,i,n,s){var r=this.ctx;r.fillStyle=s||this.color,r.fillRect(this.x+e,this.y+t,i,n)}},{key:"circle",value:function(e,t,i,n,s,r){var o=this.ctx;o.beginPath(),o.arc(this.x+e+i,this.y+t+i,i,0,2*Math.PI,!1),o.fillStyle=n||this.color,o.fill(),arguments.length>4&&(o.strokeStyle=r||this.color,o.lineWidth=s,o.stroke())}},{key:"arc",value:function(e,t,i,n,s,r,o){var a=this.ctx;a.beginPath(),a.arc(this.x+e,this.y+t,i,n,s,!1),a.lineWidth=o,a.strokeStyle=r||this.color,a.stroke()}},{key:"animate",value:function(e,i){return"Fade"!==e?(console.warn("animte() not supported on Canvas objects yet. Effect not applied."),a.a.resolve(!0)):u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"animate",this).call(this,e,i)}}]),t}(o.a);window.Canvas=l,t.a=l},/*!*******************************!*\
  !*** ./js/Drawable/Sprite.js ***!
  \*******************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Drawable */2),a=i(/*! ../Util/Deferred */0),h=i(/*! ../Util/Dom */6),u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},c=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e||"Sprite",i||{}));return r.imageId=i&&i.imageId||null,i&&i.animations&&r.load(i.animations),r}return r(t,e),u(t,[{key:"initProperties",value:function(){this.animations={},this.currentAnim=null,this.currentFrame=null,this.currentFrameNum=this.previousFrameNum=0,this.loaded=!1,this.currentAnimName="",this.storedAnimName="",this.storedFrameNum=0,this.numFrames=0,this.rewindOnEnd=!1,this.direction=1,this.frameCounter=0,this.animEndDef=null,this.animChangeDef=null,this.rewinded=!1,this.isDebug=!1}},{key:"debug",value:function(e){this.isDebug=e}},{key:"addAnimation",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};if(n[e]=Object.assign({frameDuration:1,loop:1,frames:[]},i),!i.frameWidth||!i.frameHeight||!i.numFrames)return void console.error("Parameter missing: frameWidth, frameHeight, numFrames are all required!");this.imageId=t;for(var s=i.offsetX||0,r=i.offsetY||0,o=0,a=i.numFrames||0,h=n[e].frames,u=i.frameHeight,l=i.frameWidth+(i.frameSpacing||0);o<a;)h.push({offsetX:s,offsetY:r,width:i.frameWidth,height:u,hitBox:{x:0,y:0,x2:i.frameWidth-1,y2:u-1}}),s+=l,o++;a&&this.load(n)}},{key:"load",value:function(e){var t=this,i=e||this._settings.animations,n=void 0;this.loaded||this.initProperties(),Object.keys(i).forEach(function(e){var s=i[e];t.animations[e]=s,n=e,s.flipFrom&&t.updateFlipAnimation(s,s.flipFrom,s.flipType)}),this.loaded||(this.loaded=!0,this.setAnimation(n))}},{key:"updateFlipAnimation",value:function(e,t,i){var n=this.animations[t].frames;e.frames=new Array(n.length);for(var s=0;s<n.length;++s)e.frames[s]={},Object.assign(e.frames[s],n[s]),1&i&&(e.frames[s].hitBox.x=n[s].width-n[s].hitBox.x2,e.frames[s].hitBox.x2=n[s].width-n[s].hitBox.x),2&i&&(e.frames[s].hitBox.y=n[s].height-n[s].hitBox.y2,e.frames[s].hitBox.y2=n[s].height-n[s].hitBox.y)}},{key:"setImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return void console.warn("[Sprite] setImage(): image not loaded",this.imageId||this.imageSrc);this.image&&!t||(this.image=e,this.children.forEach(function(t){t.setImage(e)}))}},{key:"rewind",value:function(){this.direction=-this.direction,this.running=!0,this.rewinded=!0,this.nextFrame(),console.log("[Sprite] rewind",this.currentFrameNum,this.running,this.rewinded,this.direction)}},{key:"nextFrame",value:function(){if(this.running)if(this.currentFrameNum+=this.direction,this.currentFrameNum<0||this.currentFrameNum>=this.numFrames)switch(this.currentAnim.loop){case 2:this.direction=-this.direction,this.currentFrameNum=this.currentFrameNum<0?0:this.numFrames-1,this.currentFrame=this.currentAnim.frames[this.currentFrameNum];break;case 1:this.currentFrameNum=this.currentAnim.loopFrom?this.currentAnim.loopFrom:0,this.currentFrame=this.currentAnim.frames[this.currentFrameNum];break;default:!this.currentAnim.rewindOnEnd||this.rewinded?(this.currentFrameNum-=this.direction,this.running=!1,this._animationEnded()):this.currentAnim.rewindOnEnd&&this.rewind()}else this.currentFrame=this.currentAnim.frames[this.currentFrameNum]}},{key:"storeCurrentAnim",value:function(){this.storedAnimName=this.currentAnimName,this.storedFrameNum=this.currentFrameNum}},{key:"restorePreviousAnim",value:function(){this.setAnimation(this.storedAnimName,null,this.storedFrameNum)}},{key:"advanceFrame",value:function(e){this.previousFrameNum=this.currentFrameNum,this.currentAnim!==this.animations[e]?(this.frameCounter=0,this.setAnimation(e)):++this.frameCounter>this.currentAnim.frameDuration&&(this.nextFrame(),this.frameCounter=0)}},{key:"getCurrentWidth",value:function(){return this.currentFrame.width}},{key:"getCurrentHeight",value:function(){return this.currentFrame.height}},{key:"getCurrentOffsetX",value:function(){return this.currentFrame.offsetX}},{key:"getCurrentOffsetY",value:function(){return this.currentFrame.offsetY}},{key:"getCurrentShiftX",value:function(){return this.currentFrame.shiftX||0}},{key:"getCurrentShiftY",value:function(){return this.currentFrame.shiftY||0}},{key:"getHitBox",value:function(){return this.currentFrame.hitBox||{x:0,y:0,x2:this.getCurrentWidth()-1,y2:this.getCurrentHeight()-1}}},{key:"getHitBox2",value:function(){var e=this.currentFrame.hitBox;return{x:this.x+e.x,x2:this.x+e.x2,y:this.y+e.y,y2:this.y+e.y2}}},{key:"centerXOverTile",value:function(e){var t=this.currentMap.tileWidth,i=this.getCurrentWidth(),n=Math.floor((t-i)/2);i<=t&&(this.x=e.x*t+n)}},{key:"clearMove",value:function(){this.running=!1}},{key:"setAnimation",value:function(e,t,i,n){this.loaded||this.load();try{this.currentAnim&&this._animationEnded(),this.animEndDef=new a.a,this.currentAnim&&this._animationChanged(this.currentAnimName,e),this.animChangeDef=new a.a,this.currentAnim=this.animations[e],this.currentAnimName=e,this.numFrames=this.currentAnim.frames.length,this.currentFrameNum=this.previousFrameNum=n?this.numFrames-1:i||0,this.currentFrame=this.currentAnim.frames[this.currentFrameNum],this.running=!0,this.rewinded=!1,this.direction=n?-1:1,"function"==typeof t&&this.onAnimationEnd(t)}catch(t){console.error("[Sprite] setAnimation() - unable to set animation ",e,"("+t.message+")","for sprite",this.id)}}},{key:"stopAnimation",value:function(e){this.running=!1,this.animEndDef&&!e&&this.animEndDef.reject()}},{key:"startAnimation",value:function(){this.running=!0}},{key:"onAnimationEnd",value:function(e){this.animEndDef.promise.then(e.bind(this))}},{key:"onAnimationChange",value:function(e){this.animChangeDef.promise.then(e.bind(this))}},{key:"_animationEnded",value:function(){this.animEndDef.resolve(this.currentAnimName,this.currentFrameNum)}},{key:"_animationChanged",value:function(e,t){this.animChangeDef.resolve(e,t)}},{key:"onHit",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onHit",this).call(this,e),console.log("[Sprite] oops, ",this.type," [",this.id,"] ","was hit by",e.name," [",e.id,"]")}},{key:"draw",value:function(e){if(this.visible&&this.image&&this.currentAnimName){this.currentAnimName.length&&this.advanceFrame(this.currentAnimName);var t=this.getCurrentWidth(),i=t*this.scale,n=this.getCurrentHeight(),s=n*this.scale,r=Math.floor(i/2),o=Math.floor(s/2),a=this.getCurrentOffsetX(),h=this.getCurrentOffsetY(),u=this.currentAnim.flipFrom?this.x+this.getCurrentShiftX()-i:this.x+this.getCurrentShiftX(),l=this.currentAnim.flipFrom?this.y+this.getCurrentShiftY()-s:this.y+this.getCurrentShiftY(),c=this.currentMap&&this.currentMap.viewportX||0,f=this.currentMap&&this.currentMap.viewportY||0;t&&n&&(this.executeFx(e),this.mask&&!this.mask.exclude&&this._applyMask(e,Math.floor(u+c),Math.floor(l+f)),e.setTransform(this.scale,0,0,this.scale,u+c+r,l+f+o),e.rotate(this.angle),e.drawImage(this.image,Math.floor(a),Math.floor(h),Math.floor(t),Math.floor(n),Math.floor(-r),Math.floor(-o),Math.floor(i),Math.floor(s)),this.mask&&this.mask.exclude&&(e.setTransform(1,0,0,1,0,0),this._applyMask(e,Math.floor(u+c),Math.floor(l+f))),this._undoMask(e))}}},{key:"describeAllAnimations",value:function(){var e=this,t=null,n=this,s=1,r=1,o=0,a=0,u=0,l=0,c=void 0,f=null;Object.keys(this.animations).forEach(function(i){t=e.animations[i],o=t.frames[0].width,a=t.frames[0].height,(o+5)*t.frames.length>u&&(u=(o+5)*t.frames.length),l+=a+5}),c=document.getElementById("describe"),c||(c=document.createElement("canvas"),c.id="describe",c.setAttribute("width",u.toString()),c.setAttribute("height",l.toString())),f=i.i(h.a)("#describe")[0]&&i.i(h.a)("#describe")[0].getContext("2d")||new h.a("canvas").attr("id","describe").attr("width",u).attr("height",l).css("zIndex","100").appendTo("body")[0].getContext("2d"),f.webkitImageSmoothingEnabled=!1,Object.keys(this.animations).forEach(function(i){s=1,t=e.animations[i],console.log(i,"got",t.frames.length),console.log("frameDuration=",t.frameDuration),console.log("loop=",t.loop),console.log("loopFrom=",t.loopFrom),console.log("rewindOnEnd",t.rewindOnEnd),t.frames.forEach(function(e){var t=e.width,i=e.height,a=e.offsetX,h=e.offsetY,u=e.hitBox;f.drawImage(n.image,a,h,t,i,s,r,t,i),f.strokeStyle="rgb(240,240,240)",f.beginPath(),f.moveTo(s-1,r-1),f.lineTo(s+t,r-1),f.lineTo(s+t,r+i+1),f.lineTo(s-1,r+i+1),f.lineTo(s-1,r-1),f.closePath(),f.lineCap="butt",f.stroke(),u&&(f.strokeStyle="rgb(0,230,0)",f.beginPath(),f.moveTo(s+u.x,r+u.y),f.lineTo(s+u.x2,r+u.y),f.lineTo(s+u.x2,r+u.y2),f.lineTo(s+u.x,r+u.y2),f.lineTo(s+u.x,r+u.y),f.closePath(),f.stroke()),s+=o+5}),r+=a+5})}},{key:"listAnimations",value:function(){return this.animations}}]),t}(o.a);t.a=c},/*!********************************!*\
  !*** ./js/FX/Easing/Easing.js ***!
  \********************************/
function(e,t,i){"use strict";var n=i(/*! ../FX */3),s={easeInQuad:function(e,t,i,n,s){return n*(t/=s)*t+i},easeOutBounce:function(e,t,i,n,s){return(t/=s)<1/2.75?n*(7.5625*t*t)+i:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+i:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+i:n*(7.5625*(t-=2.625/2.75)*t+.984375)+i},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};Object.keys(s).forEach(function(e){return n.a.addEasing(e,s[e])}),t.a=s},/*!********************************!*\
  !*** ./js/FX/Effect/Custom.js ***!
  \********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Effect */8),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.callback=e.callback,r.diff=r.endValue-r.startValue,r}return r(t,e),a(t,[{key:"process",value:function(e,i){return h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this),this.callback(this.startValue+this.animProgress*this.diff,e,i),this.ended}}]),t}(o.a);t.a=u},/*!******************************!*\
  !*** ./js/FX/Effect/Fade.js ***!
  \******************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Effect */8),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({startValue:0,endValue:1},e),i));return r.startOpacity=void 0!==r.startValue?e.startValue:0,r.endOpacity=void 0!==r.endValue?e.endValue:1,r.diff=r.endValue-r.startValue,r}return r(t,e),a(t,[{key:"start",value:function(){return this.currentOpacity=1,h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this)}},{key:"process",value:function(e,i,n){return h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this),this.currentOpacity=this.startValue+this.animProgress*this.diff,n.setOpacity(this.currentOpacity),this.ended}}]),t}(o.a);t.a=u},/*!********************************!*\
  !*** ./js/FX/Effect/Mosaic.js ***!
  \********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Effect */8),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({startValue:.002,endValue:1},e),i));return r.buffer=i.getBuffer(r.width,r.height),r.startWidth=null,r.ratio=r.width/r.height,r.diff=r.endValue*r.width-r.startValue*r.width,r}return r(t,e),a(t,[{key:"start",value:function(){return this.startWidth=this.startValue*this.width,h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this)}},{key:"process",value:function(e){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this);var i=this.startWidth+this.animProgress*this.diff,n=i/this.ratio;return this.buffer.drawImage(e.canvas,0,0,0|i,0|n),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(this.buffer.canvas,0,0,0|i,0|n,0,0,this.width,this.height),this.ended}}]),t}(o.a);t.a=u},/*!********************************!*\
  !*** ./js/FX/Effect/Rotate.js ***!
  \********************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=i(/*! ./Effect */8),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in s)return s.value;var o=s.get;if(void 0!==o)return o.call(n)},u=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Object.assign({startValue:0,endValue:2*Math.PI,loop:!0},e),i));return r.startAngle=void 0!==r.startAngle?e.startValue:0,r.endAngle=void 0!==r.endAngle?e.endValue:1,r.diff=r.endValue-r.startValue,r}return r(t,e),a(t,[{key:"start",value:function(){return this.currentAngle=this.startAngle,h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this)}},{key:"stop",value:function(e,i){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),e.setAngle(i)}},{key:"process",value:function(e,i,n){return h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this),this.currentAngle=this.startValue+this.animProgress*this.diff,n.setAngle(this.currentAngle),this.ended}}]),t}(o.a);t.a=u},/*!*************************!*\
  !*** ./js/Game/Game.js ***!
  \*************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=i(/*! ../Resource/ResourceManager */5),r=i(/*! ../Display/DisplayManager */12),o=i(/*! ../Audio/AudioManager */7),a=i(/*! ../Notification/NotificationManager */9),h=i(/*! ../Input/InputManager */10),u=i(/*! ../lib/fpscounter/fpscounter.min */40),l=i.n(u),c=i(/*! ../Util/Dom */6),f=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),d=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),console.log("[Game] Init()"),this.debug=r.debug,this.name=r.name;var o=r.target&&new c.a(r.target);this.showFps=void 0!==r.showFps&&r.showFps,this.showFps&&l()({width:50,height:50}),this.width=r.width||1024,this.height=r.height||768,this.target=o&&o.length&&o[0]||i.i(c.a)("div").css({width:this.width+"px",height:this.height+"px"}).appendTo("body")[0],i.i(c.a)(this.target).addClass("athena-game"),this.resources=r.resources,this.display=null,this.scene=null,this.running=!1,this._initEvents(),this.createDisplay({name:"main",width:r.width,height:r.height,layers:r.layers||[!1,!0]},this.target),this.toggleSound(void 0===r.sound||r.sound),this.sound||(console.warn("sound disabled: skipping audio resources"),s.a.skipResources.push("audio")),this.timeout=null,this.animFrame=null,this.bindEvents("*"),r.scene&&this.setScene(r.scene),this.debug&&(document.addEventListener("keyup",function(e){68===e.keyCode?t.scene&&(t.scene.debug(),t.scene.map&&t.toggleTileInspector(t.scene.isDebug)):70===e.keyCode?t.toggleFullscreen():80===e.keyCode&&t.togglePause()}),navigator.userAgent.match(/Xbox/)&&this.target.addEventListener("click",function(){console.log("[Game] Toggling fullscreen."),t.toggleFullscreen()}))}return f(e,[{key:"addInspector",value:function(){var e=this;this.moveHandler=function(t){var i=e.scene.map,n=t.offsetX>0?t.offsetX:0,s=t.offsetY>0?t.offsetY:0,r=e.scene.mapOffsetX,o=e.scene.mapOffsetY,a=i.viewportW,h=i.viewportH;if(t.offsetX<r||t.offsetX>r+a||t.offsetY<o||t.offsetY>o+h)e.tileInspector.hide(),e.tileHover.hide();else{var u=i.getTileIndexFromPixel(n-r-i.viewportX,s-o-i.viewportY);u?(e.tileInspector.html(u.x+", "+u.y+"<br />["+i.map[u.x+u.y*i.numCols]+", "+i.tileBehaviors[u.x+u.y*i.numCols]+"]").css({left:0,top:0}),e.tileInspector.show(),e.tileHover.css({left:u.x*i.tileWidth+r+i.viewportX+"px",top:u.y*i.tileHeight+o+i.viewportY+"px"}).show()):(e.tileInspector.hide(),e.tileHover.hide())}},this.tileInspector=new c.a("div").css({border:"1px dotted white","background-color":"rgba(0,0,0,.7)",color:"white","z-index":10,position:"absolute","pointer-events":"none"}).appendTo(this.target),this.tileHover=new c.a("div").css({border:"1px dotted white",width:this.scene.map.tileWidth+"px",height:this.scene.map.tileHeight+"px","background-color":"rgba(255,0,0,.4)",position:"absolute","z-index":10,top:0,left:0,"pointer-events":"none"}).appendTo(this.target),i.i(c.a)(this.target).css("position","relative")}},{key:"toggleTileInspector",value:function(e){e?(this.tileInspector||this.addInspector(),this.tileInspector.show(),this.target.addEventListener("mousemove",this.moveHandler,!1)):this.tileInspector&&(this.target.removeEventListener("mousemove",this.moveHandler),this.tileInspector.hide(),this.tileHover.hide())}},{key:"bindEvents",value:function(e){a.a.listen(e,this.onEvent.bind(this))}},{key:"onEvent",value:function(e){}},{key:"toggleSound",value:function(e){this.sound=e,o.a.toggleSound(e)}},{key:"toggleFullscreen",value:function(){this.display&&this.display.toggleFullscreen()}},{key:"createDisplay",value:function(e,t){this.display=r.a.addDisplay(e,t)}},{key:"_initEvents",value:function(){h.a.init(),this._addVisibilityEvents()}},{key:"_addVisibilityEvents",value:function(){var e=this,t="",i="";console.log("[Game] adding visibility events"),void 0!==document.hidden?(i="hidden",t="visibilitychange"):void 0!==document.msHidden?(i="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(i="webkitHidden",t="webkitvisibilitychange"),t.length?document.addEventListener(t,function(){console.log("[Game] got visibility event "+document[i]),document[i]&&e.running&&e.togglePause()},!1):console.warn("[Game] Visibility API not available.")}},{key:"setScene",value:function(e){console.log("[Game] setScene: "+e.name),this.scene!==e&&(this.scene&&(this._stopSceneLoops(),this.scene._stop(),this.toggleTileInspector(!1)),e?this._setupScene(e):console.warn("[Game] Attempt to set non-existing scene:",e))}},{key:"_startScene",value:function(){var e=this.scene.hudScene;this.display.clearAllScreens(),this.scene._start(),this.scene.start(),e&&e.start(),this._runSceneLoop(),this._renderSceneLoop()}},{key:"_setupScene",value:function(e){var t=this;this.scene=e;var i=e.hudScene;window.currentScene=e,this.scene.setDisplay(this.display),this.display.clearDisplay(),this.scene._setup(),this.scene.setup(),i&&i.setup(),this.scene._load().then(function(e){t.scene===e?t._startScene():console.warn("[Game] scene",e,"has finished loading but is not the current scene anymore so it won't be started.")}).catch(function(e){console.error(e)})}},{key:"_renderSceneLoop",value:function(){var e=this.scene;this.running&&(h.a.playingEvents&&h.a.nextRecordedEvents(),this.animFrame=window.requestAnimationFrame(this._renderSceneLoop.bind(this)),this.display.renderScene(e),e.hudScene,h.a.recording&&h.a.recordEvents())}},{key:"_runSceneLoop",value:function(){var e=this.scene;this.running||(this.running=!0),e.update((new Date).getTime()),this.running&&(this.timeout=setTimeout(this._runSceneLoop.bind(this),16))}},{key:"togglePause",value:function(){this.running?(this.running=!1,this.scene.pause(this.running),this.display.renderScene(this.scene),this._stopSceneLoops()):(this.running=!0,this.scene.pause(this.running),this._runSceneLoop(),this._renderSceneLoop())}},{key:"_stopSceneLoops",value:function(){this.running=!1,console.log("[Game] Scene stopped, stopping run & render loops"),this.animFrame&&(window.cancelAnimationFrame(this.animFrame),this.animFrame=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}]),e}();t.a=d},/*!***************************!*\
  !*** ./js/Scene/Scene.js ***!
  \***************************/
function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=i(/*! ../Resource/ResourceManager */5),o=i(/*! ../Map/Map */15),a=i(/*! ../Notification/NotificationManager */9),h=i(/*! ../Input/InputManager */10),u=i(/*! ../Util/Dom */6),l=i(/*! ../Util/Deferred */0),c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();window.scenes={};var f=function(){function e(t){s(this,e),t=t||{},this.layers=new Array(t.layers||2),this.readyDef=null,this.resources=t.resources||[],this.pics={},this.map=null,this.mapOffsetX=0,this.mapOffsetY=0,this.loaded=!1,this.running=!1,this.backgroundImage=null,this.name=t.name||"Scene"+e.count++,this.opacity=void 0!==t.opacity?t.opacity:1,this.hudScene=t.hudScene||null,this.time=null,this.playTime=null,window.scenes[this.name]=this,this._objectsToAdd=[],this.isDebug=!1}return c(e,[{key:"_prepareCanvas",value:function(){this.resources&&this.display.prepareCanvas(this.resources)}},{key:"_emptyLayers",value:function(){for(var e=0;e<this.layers.length;++e)this.layers[e]=[]}},{key:"_getResourcesRef",value:function(){var e=this.resources;e&&e.forEach(function(e){e.elt=r.a.getResourceById(e.id)})}},{key:"fadeIn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return this.animate("Fade",{startValue:0,endValue:1,duration:e})}},{key:"fadeOut",value:function(e){return this.animate("Fade",{startValue:1,endValue:0,duration:e})}},{key:"fadeInAndOut",value:function(e,t,i){var n=this,s=new l.a;return this.fadeIn(e).then(function(){setTimeout(function(){n.fadeOut(i).then(function(){s.resolve()})},t)}),s.promise}},{key:"_loadResources",value:function(e,t){var i=this;return this.loaded?(console.log("[Scene "+this.name+"] _loadResources() - Scene is loaded."),this._onLoad()):(console.log("[Scene "+this.name+"] _loadResources() - Loading scene."),this.readyDef=r.a.addResources(e),this.readyDef.then(function(){i.loaded=!0,i._onLoad()}).catch(function(e){console.error(e)}),r.a.loadResources("any",t)),this.readyDef}},{key:"load",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.loaded)return void console.log("Scene already loaded");this.resources.push({type:e,src:t,id:i||t})}},{key:"loadImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("image",e,t||e)}},{key:"loadAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("audio",e,t||e)}},{key:"loadMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.load("map",e,t||e)}},{key:"_load",value:function(){var e=this,t=new l.a;return this.hudScene&&!this.hudScene.loaded?this.hudScene._load().then(function(){e._loadResources(e.resources).then(function(){t.resolve(e)})}).catch(function(e){console.error(e)}):this._loadResources(this.resources).then(function(){return t.resolve(e)}),t.promise}},{key:"debug",value:function(e){var t=void 0!==e?e:!this.isDebug;this.isDebug=t,this.hudScene&&this.hudScene.debug(t),this.map&&this.map.debug(t)}},{key:"_onLoad",value:function(){var e=this;this._cacheImages(),this._getResourcesRef(),this._prepareCanvas(),this._objectsToAdd.forEach(function(t){return e.addObject.apply(e,n(t))})}},{key:"_cacheImages",value:function(){if(console.log("[Scene "+this.name+"] caching Images"),this.resources)try{for(var e=0,t=this.resources.length;e<t;e++){var i=this.resources[e].id,n=this.resources[e].src;"image"===this.resources[e].type&&(this.pics[i]=r.a.getResourceById(i),this.pics[n]=r.a.getResourceById(i))}}catch(e){throw e}}},{key:"setMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e instanceof o.a?this.map=e:this.map=new o.a(e),this.map.setScene(this),this.mapOffsetX=t,this.mapOffsetY=i,window.currentMap=this.map}},{key:"_setObjectImage",value:function(e){"function"!=typeof e.setImage||e.image||e.setImage(this.pics[e.imageId||e.imageSrc])}},{key:"_addObjectToLayer",value:function(e,t){this.layers[e].push(t),this._setObjectImage(t),t.setScene(this),t.layer=e}},{key:"addObject",value:function(e,t){if(!this.loaded)return void this._objectsToAdd.push(Array.from(arguments));var i=t||0;if(Array.isArray(e)){var n=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var h=o.value;this._addObjectToLayer(i,h)}}catch(e){s=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}}else this._addObjectToLayer(i,e)}},{key:"drawMap",value:function(e){this.map.isDirty&&(this.display.clearScreen(e),this.map.draw(e,!1,this.mapOffsetX,this.mapOffsetY))}},{key:"drawMapObjects",value:function(e){this.map.drawObjects(e,this.mapOffsetX,this.mapOffsetY)}},{key:"drawSceneObjects",value:function(e){for(var t=this,i=0,n=this.layers.length;i<n;i++)!function(i,n){for(var s=t.layers[i],r=e[i],o=0,a=s.length;o<a;o++){var h=s[o];h._draw(r),t.isDebug&&t.isDebug&&h.showHitBox(r),h.children.length&&h.children.forEach(function(e){e._draw(r),t.isDebug&&e.showHitBox(r)})}}(i)}},{key:"moveSceneObjects",value:function(e){for(var t=0,i=this.layers.length;t<i;t++)for(var n=this.layers[t],s=0,r=n.length;s<r;s++){var o=n[s];o.movable&&o.update(e)}}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setBackgroundImage",value:function(e){this.backgroundImage=e,e instanceof Image?new u.a(this.display.target).css("backgroundImage","url("+e.src+")"):new u.a(this.display.target).css("backgroundImage","url("+e+")")}},{key:"setup",value:function(){this.hudScene&&this.hudScene.setup()}},{key:"_setup",value:function(){this._emptyLayers(),this.map&&this.map.reset(),h.a.clearEvents(),this.hudScene&&this.hudScene._setup()}},{key:"_start",value:function(){this.running=!0,this.time=(new Date).getTime(),this.playTime=null,this.hudScene&&this.hudScene._start()}},{key:"_stop",value:function(){this._reset(),this.stop()}},{key:"_reset",value:function(){this.debug(!1),this._objectsToAdd=[]}},{key:"start",value:function(){}},{key:"stop",value:function(){this.running=!1,this.hudScene&&this.hudScene.stop()}},{key:"pause",value:function(e){}},{key:"getPlayTime",value:function(){return(this.playTime?this.playTime:(new Date).getTime()-this.time)/1e3}},{key:"update",value:function(e){this.moveSceneObjects(e),this.map&&(this.map.update(e),this.map.checkCollisions(e))}},{key:"render",value:function(e){var t=e.length-1;this.map&&(this.drawMap(e[t]),this.drawMapObjects(e)),this.drawSceneObjects(e)}},{key:"setLayerPriority",value:function(e,t){this.display.setLayerZIndex(e,t?0:2)}},{key:"notify",value:function(e,t){a.a.notify(e,t)}},{key:"bindEvents",value:function(e){a.a.listen(e,this.onEvent.bind(this))}},{key:"onEvent",value:function(){}},{key:"setDisplay",value:function(e){this.display=e,this.hudScene&&this.hudScene.setDisplay(e)}},{key:"animate",value:function(e,t){return this.display.animate(e,t,this)}},{key:"removeObject",value:function(e){var t=this.layers[e.layer],i=t.indexOf(e);i>-1&&t.splice(i,1)}}]),e}();f.count=1,t.a=f},/*!*********************************************!*\
  !*** ./js/lib/fpscounter/fpscounter.min.js ***!
  \*********************************************/
function(e,t){/*
 * fpscounter.js
 *
 * A simple in-browser fps counter, suitable for using with a bookmarklet
 * 
 * @author Pete Otaqui <pete@otaqui.com>
 * @url https://github.com/pete-otaqui/fpscounter
 * @license Creative Commons Attribution 3.0 Unported
 * @license http://creativecommons.org/licenses/by/3.0/deed.en_GB
*/
!function(e){e.fpscounter=function(t){function i(e,t){return(!e[0]||t<e[0])&&(e[0]=t),(!e[1]||t>e[1])&&(e[1]=t),e}function n(){var e,t,r,o,a,l;M=!0,O=Date.now(),O>=S+E&&(e=Math.min(60,Math.round(1/(O-T)*1e3)),P.unshift(e),f.clearRect(0,0,h,u),P.length>A&&P.pop(),t=P.reduce(i,[]),r=t[0],o=t[1],a=o-r,f.fillStyle=k,f.beginPath(),f.moveTo(h,u),P.forEach(function(e,t){l=s(t,e,r,a),f.lineTo(l[0],l[1])}),f.lineTo(l[0],u),f.lineTo(h,u),f.fill(),f.stroke(),f.fillStyle="#fff",f.font=b,f.fillText(e,d,p),f.font=w,f.fillText(r,m,g),f.fillText(o,v,y),S=O),T=O,M&&(C=requestAnimationFrame(n))}function s(e,t,i,n){return[h-e,u-u*(t-i)/n]}function r(){T=Date.now(),P=[],S=T,n()}t=t||{};var o=e.fpscounter_options||{},a={remove_on_click:!1,width:100,height:50};Object.keys(a).forEach(function(e){t[e]=t[e]||o[e]||a[e]});var h=t.width,u=t.height,l=document.createElement("div");l.className="fpscounter",l.style.width=h+"px",l.style.height=u+"px";var c=document.createElement("canvas");c.className="fpscounter-canvas",c.width=h,c.height=u;var f=c.getContext("2d"),d=h/2-14,p=u/2+10,v=4,y=8,m=4,g=u-4,b="bold 30px Monospace",w="10px Monospace",k=f.createLinearGradient(0,0,0,u);k.addColorStop(0,"#001133"),k.addColorStop(1,"#112288");var x=f.createLinearGradient(0,0,0,u);x.addColorStop(0,"#2848d8"),x.addColorStop(1,"#3366ff"),f.lineWidth=1,f.strokeStyle=x;var _=document.createElement("style");_.textContent=".fpscounter { position: fixed; top: 0; right: 0; background-color: #000; color: #fff; font-size: 30px; font-family: monospace;z-index: 999999}",l.appendChild(c),document.body.appendChild(l),document.querySelector("head").appendChild(_);var T,O,S,E,C,M,P=[],A=h;E=100,l.addEventListener("click",function(){M=!M,M?r():(cancelAnimationFrame(C),t.remove_on_click&&document.body.removeChild(l))}),r()},!e.fpscounter_options||e.fpscounter_options.auto_start}(window),e.exports=fpscounter},/*!******************************!*\
  !*** ./~/process/browser.js ***!
  \******************************/
function(e,t){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function s(e){if(l===setTimeout)return setTimeout(e,0);if((l===i||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function r(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function o(){v&&d&&(v=!1,d.length?p=d.concat(p):y=-1,p.length&&a())}function a(){if(!v){var e=s(o);v=!0;for(var t=p.length;t;){for(d=p,p=[];++y<t;)d&&d[y].run();y=-1,t=p.length}d=null,v=!1,r(e)}}function h(e,t){this.fun=e,this.array=t}function u(){}var l,c,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:i}catch(e){l=i}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var d,p=[],v=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new h(e,t)),1!==p.length||v||s(a)},h.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.prependListener=u,f.prependOnceListener=u,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},/*!**************************************!*\
  !*** ./~/web-audio-daw/build/wad.js ***!
  \**************************************/
function(e,t,i){var n,s;!function(i,r){n=[],void 0!==(s=function(){return i.Wad=r()}.apply(t,n))&&(e.exports=s)}(this,function(){!function(e){var t=function(e,t){var i=t||{},n=i.bufferLen||4096,s=i.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,n,s,s);var r=new Worker(i.workerPath||"recorderWorker.js");r.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:s}});var o,a=!1;this.node.onaudioprocess=function(e){if(a){for(var t=[],i=0;i<s;i++)t.push(e.inputBuffer.getChannelData(i));r.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])},this.record=function(){a=!0},this.stop=function(){a=!1},this.clear=function(){r.postMessage({command:"clear"})},this.getBuffer=function(e){o=e||i.callback,r.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(o=e||i.callback,t=t||i.type||"audio/wav",!o)throw new Error("Callback not set");r.postMessage({command:"exportWAV",type:t})},r.onmessage=function(e){var t=e.data;o(t)},e.connect(this.node),this.node.connect(this.context.destination)};t.forceDownload=function(t,i){var n=(e.URL||e.webkitURL).createObjectURL(t),s=e.document.createElement("a");s.href=n,s.download=i||"output.wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),s.dispatchEvent(r)},e.Recorder=t}(window),function(t){function i(){return n}function n(e){if(!(this instanceof n))return new n(e);if(t.AudioContext||(t.AudioContext=t.webkitAudioContext),e||(console.log("tuna.js: Missing audio context! Creating a new context for you."),e=t.AudioContext&&new t.AudioContext),!e)throw new Error("Tuna cannot initialize because this environment does not support web audio.");s(e),l=e,c=this}function s(e){function t(){var e=Array.prototype.shift.apply(arguments);return e=d.isPrototypeOf?d.isPrototypeOf(e)?e.input:e:e.input||e,arguments=Array.prototype.slice.call(arguments),arguments.unshift(e),s.apply(this,arguments),e}if(!0!==e.__connectified__){var i=e.createGain(),n=Object.getPrototypeOf(Object.getPrototypeOf(i)),s=n.connect;n.connect=t,e.__connectified__=!0}}function r(e){return Math.max(0,Math.round(100*Math.pow(2,e/6))/100)}function o(e,t){var i,n,s=0,r=0,o=0,a=0;return i=e.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(i[2],10)-(i[1]+"").length,i=t.toExponential().match(/^.\.?(.*)e(.+)$/),r=parseInt(i[2],10)-(i[1]+"").length,r>s&&(s=r),n=e%t,s<-100||s>20?(o=Math.round(Math.log(n)/Math.log(10)),a=Math.pow(10,o),(n/a).toFixed(o-s)*a):parseFloat(n.toFixed(-s))}function a(e){return 0===e?1:Math.abs(e)/e}function h(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function u(e,t){return void 0===e?t:e}var l,c,f=function(e,t){e.value=t},d=Object.create(null,{activate:{writable:!0,value:function(e){e?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(e)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(e){this._lastBypassValue!==e&&(this._bypass=e,this.activate(!e),this._lastBypassValue=e)}},connect:{value:function(e){this.output.connect(e)}},disconnect:{value:function(e){this.output.disconnect(e)}},connectInOrder:{value:function(e){for(var t=e.length-1;t--;){if(!e[t].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",e[t]);e[t+1].input?e[t].connect(e[t+1].input):e[t].connect(e[t+1])}}},getDefaults:{value:function(){var e={};for(var t in this.defaults)e[t]=this.defaults[t].value;return e}},automate:{value:function(e,t,i,n){var s,r=n?~~(n/1e3):l.currentTime,o=i?~~(i/1e3):0,a=this.defaults[e],h=this[e];h?a.automatable?(i?(s="linearRampToValueAtTime",h.cancelScheduledValues(r),h.setValueAtTime(h.value,r)):s="setValueAtTime",h[s](t,o+r)):h=t:console.error("Invalid Property for "+this.name)}}}),p="float",v="int";void 0!==e&&e.exports?e.exports=n:t.define("Tuna",i),n.prototype.Bitcrusher=function(e){e||(e=this.getDefaults()),this.bufferSize=e.bufferSize||this.defaults.bufferSize.value,this.input=l.createGain(),this.activateNode=l.createGain(),this.processor=l.createScriptProcessor(this.bufferSize,1,1),this.output=l.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var t,i,n,s,r,o=0,a=0;this.processor.onaudioprocess=function(e){for(t=e.inputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(0),n=Math.pow(.5,this.bits),r=t.length,s=0;s<r;s++)o+=this.normfreq,o>=1&&(o-=1,a=n*Math.floor(t[s]/n+.5)),i[s]=a},this.bits=e.bits||this.defaults.bits.value,this.normfreq=u(e.normfreq,this.defaults.normfreq.value),this.bypass=e.bypass||!1},n.prototype.Bitcrusher.prototype=Object.create(d,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:v},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:v},bypass:{value:!1,automatable:!1,type:"boolean"},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:p}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(e){this.processor.bits=e}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(e){this.processor.normfreq=e}}}),n.prototype.Cabinet=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.convolver=this.newConvolver(e.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=u(e.makeupGain,this.defaults.makeupGain),this.bypass=e.bypass||!1},n.prototype.Cabinet.prototype=Object.create(d,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:p},bypass:{value:!1,automatable:!1,type:"boolean"}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=e}},newConvolver:{value:function(e){return new c.Convolver({impulse:e,dryLevel:0,wetLevel:1})}}}),n.prototype.Chorus=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.attenuator=this.activateNode=l.createGain(),this.splitter=l.createChannelSplitter(2),this.delayL=l.createDelay(),this.delayR=l.createDelay(),this.feedbackGainNodeLR=l.createGain(),this.feedbackGainNodeRL=l.createGain(),this.merger=l.createChannelMerger(2),this.output=l.createGain(),this.lfoL=new c.LFO({target:this.delayL.delayTime,callback:f}),this.lfoR=new c.LFO({target:this.delayR.delayTime,callback:f}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=u(e.feedback,this.defaults.feedback.value),this.rate=u(e.rate,this.defaults.rate.value),this.delay=u(e.delay,this.defaults.delay.value),this.depth=u(e.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Chorus.prototype=Object.create(d,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:p},delay:{value:.0045,min:0,max:1,automatable:!1,type:p},depth:{value:.7,min:0,max:1,automatable:!1,type:p},rate:{value:1.5,min:0,max:8,automatable:!1,type:p},bypass:{value:!1,automatable:!1,type:"boolean"}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(e){this._delay=2*Math.pow(10,e)*2e-4,this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),n.prototype.Compressor=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.compNode=this.activateNode=l.createDynamicsCompressor(),this.makeupNode=l.createGain(),this.output=l.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=u(e.automakeup,this.defaults.automakeup.value),this.makeupGain=e.makeupGain||this.defaults.makeupGain.value,this.threshold=u(e.threshold,this.defaults.threshold.value),this.release=e.release||this.defaults.release.value,this.attack=u(e.attack,this.defaults.attack.value),this.ratio=e.ratio||this.defaults.ratio.value,this.knee=u(e.knee,this.defaults.knee.value),this.bypass=e.bypass||!1},n.prototype.Compressor.prototype=Object.create(d,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:p},release:{value:250,min:10,max:2e3,automatable:!0,type:p},makeupGain:{value:1,min:1,max:100,automatable:!0,type:p},attack:{value:1,min:0,max:1e3,automatable:!0,type:p},ratio:{value:4,min:1,max:50,automatable:!0,type:p},knee:{value:5,min:0,max:40,automatable:!0,type:p},automakeup:{value:!1,automatable:!1,type:"boolean"},bypass:{value:!1,automatable:!1,type:"boolean"}}},computeMakeup:{value:function(){var e=this.compNode;return-(e.threshold.value-e.threshold.value/e.ratio.value)/4}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(e){this._automakeup=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(e){this.compNode.threshold.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(e){this.compNode.ratio.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(e){this.compNode.knee.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(e){this.compNode.attack.value=e/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(e){this.compNode.release=e/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=r(e)}}}),n.prototype.Convolver=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.convolver=l.createConvolver(),this.dry=l.createGain(),this.filterLow=l.createBiquadFilter(),this.filterHigh=l.createBiquadFilter(),this.wet=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=u(e.dryLevel,this.defaults.dryLevel.value),this.wetLevel=u(e.wetLevel,this.defaults.wetLevel.value),this.highCut=e.highCut||this.defaults.highCut.value,this.buffer=e.impulse||"../impulses/ir_rev_short.wav",this.lowCut=e.lowCut||this.defaults.lowCut.value,this.level=u(e.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=e.bypass||!1},n.prototype.Convolver.prototype=Object.create(d,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:p},lowCut:{value:20,min:20,max:22050,automatable:!0,type:p},dryLevel:{value:1,min:0,max:1,automatable:!0,type:p},wetLevel:{value:1,min:0,max:1,automatable:!0,type:p},level:{value:1,min:0,max:1,automatable:!0,type:p}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(e){this.filterLow.frequency.value=e}},highCut:{get:function(){return this.filterHigh.frequency},set:function(e){this.filterHigh.frequency.value=e}},level:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=e}},dryLevel:{get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},wetLevel:{get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(e){var t=this.convolver,i=new XMLHttpRequest;if(!e)return void console.log("Tuna.Convolver.setBuffer: Missing impulse path!");i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(i.status<300&&i.status>199||302===i.status)&&l.decodeAudioData(i.response,function(e){t.buffer=e},function(e){e&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+e)})},i.send(null)}}}),n.prototype.Delay=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.dry=l.createGain(),this.wet=l.createGain(),this.filter=l.createBiquadFilter(),this.delay=l.createDelay(),this.feedbackNode=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=e.delayTime||this.defaults.delayTime.value,this.feedback=u(e.feedback,this.defaults.feedback.value),this.wetLevel=u(e.wetLevel,this.defaults.wetLevel.value),this.dryLevel=u(e.dryLevel,this.defaults.dryLevel.value),this.cutoff=e.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=e.bypass||!1},n.prototype.Delay.prototype=Object.create(d,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:p},feedback:{value:.45,min:0,max:.9,automatable:!0,type:p},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:p},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:p},dryLevel:{value:1,min:0,max:1,automatable:!0,type:p}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(e){this.delay.delayTime.value=e/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=e}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),n.prototype.Filter=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.filter=l.createBiquadFilter(),this.output=l.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=e.frequency||this.defaults.frequency.value,this.Q=e.resonance||this.defaults.Q.value,this.filterType=u(e.filterType,this.defaults.filterType.value),this.gain=u(e.gain,this.defaults.gain.value),this.bypass=e.bypass||!1},n.prototype.Filter.prototype=Object.create(d,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:p},Q:{value:1,min:.001,max:100,automatable:!0,type:p},gain:{value:0,min:-40,max:40,automatable:!0,type:p},bypass:{value:!1,automatable:!1,type:"boolean"},filterType:{value:"lowpass",automatable:!1,type:"string"}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(e){this.filter.type=e}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(e){this.filter.Q.value=e}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(e){this.filter.gain.value=e}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),n.prototype.MoogFilter=function(e){e||(e=this.getDefaults()),this.bufferSize=e.bufferSize||this.defaults.bufferSize.value,this.input=l.createGain(),this.activateNode=l.createGain(),this.processor=l.createScriptProcessor(this.bufferSize,1,1),this.output=l.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var t,i,n,s,r,o,a,h;t=i=n=s=r=o=a=h=0;var c,f,d,p,v,y;this.processor.onaudioprocess=function(e){for(c=e.inputBuffer.getChannelData(0),f=e.outputBuffer.getChannelData(0),d=1.16*this.cutoff,inputFactor=d*d*.35013*(d*d),p=this.resonance*(1-.15*d*d),y=c.length,v=0;v<y;v++)c[v]-=h*p,c[v]*=inputFactor,r=c[v]+.3*t+(1-d)*r,t=c[v],o=r+.3*i+(1-d)*o,i=r,a=o+.3*n+(1-d)*a,n=o,h=a+.3*s+(1-d)*h,s=a,f[v]=h},this.cutoff=u(e.cutoff,this.defaults.cutoff.value),this.resonance=u(e.resonance,this.defaults.resonance.value),this.bypass=e.bypass||!1},n.prototype.MoogFilter.prototype=Object.create(d,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:v},bypass:{value:!1,automatable:!1,type:"boolean"},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:p},resonance:{value:3.5,min:0,max:4,automatable:!1,type:p}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(e){this.processor.cutoff=e}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(e){this.processor.resonance=e}}}),n.prototype.Overdrive=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.inputDrive=l.createGain(),this.waveshaper=l.createWaveShaper(),this.outputDrive=l.createGain(),this.output=l.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=u(e.drive,this.defaults.drive.value),this.outputGain=u(e.outputGain,this.defaults.outputGain.value),this.curveAmount=u(e.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=u(e.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=e.bypass||!1},n.prototype.Overdrive.prototype=Object.create(d,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:p,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:p,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:p},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:v}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(e){this._drive=e}},curveAmount:{get:function(){return this._curveAmount},set:function(e){this._curveAmount=e,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(e){this._outputGain=r(e)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(e){this._algorithmIndex=e,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(e,t,i){e=Math.min(e,.9999);var n,s,r=2*e/(1-e);for(n=0;n<t;n++)s=2*n/t-1,i[n]=(1+r)*s/(1+r*Math.abs(s))},function(e,t,i){var n,s,r;for(n=0;n<t;n++)s=2*n/t-1,r=(.5*Math.pow(s+1.4,2)-1)*r>=0?5.8:1.2,i[n]=h(r)},function(e,t,i){var n,s,r,o=1-e;for(n=0;n<t;n++)s=2*n/t-1,r=s<0?-Math.pow(Math.abs(s),o+.04):Math.pow(s,o),i[n]=h(2*r)},function(e,t,i){var n,s,r,o,h=1-e>.99?.99:1-e;for(n=0;n<t;n++)s=2*n/t-1,o=Math.abs(s),o<h?r=o:o>h?r=h+(o-h)/(1+Math.pow((o-h)/(1-h),2)):o>1&&(r=o),i[n]=a(s)*r*(1/((h+1)/2))},function(e,t,i){var n,s;for(n=0;n<t;n++)s=2*n/t-1,i[n]=s<-.08905?-.75*(1-Math.pow(1-(Math.abs(s)-.032857),12)+1/3*(Math.abs(s)-.032847))+.01:s>=-.08905&&s<.320018?s*s*-6.153+3.9375*s:.630035},function(e,t,i){var n,s,r=2+Math.round(14*e),o=Math.round(Math.pow(2,r-1));for(n=0;n<t;n++)s=2*n/t-1,i[n]=Math.round(s*o)/o}]}}),n.prototype.Phaser=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.splitter=this.activateNode=l.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=l.createGain(),this.feedbackGainNodeR=l.createGain(),this.merger=l.createChannelMerger(2),this.filteredSignal=l.createGain(),this.output=l.createGain(),this.lfoL=new c.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new c.LFO({target:this.filtersR,callback:this.callback});for(var t=this.stage;t--;)this.filtersL[t]=l.createBiquadFilter(),this.filtersR[t]=l.createBiquadFilter(),this.filtersL[t].type="allpass",this.filtersR[t].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=u(e.rate,this.defaults.rate.value),this.baseModulationFrequency=e.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=u(e.depth,this.defaults.depth.value),this.feedback=u(e.feedback,this.defaults.feedback.value),this.stereoPhase=u(e.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Phaser.prototype=Object.create(d,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:p},depth:{value:.6,min:0,max:1,automatable:!1,type:p},feedback:{value:.7,min:0,max:1,automatable:!1,type:p},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:p},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:p}}},callback:{value:function(e,t){for(var i=0;i<4;i++)e[i].frequency.value=t}},depth:{get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(e){this._baseModulationFrequency=e,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=o(t,2*Math.PI),this.lfoR._phase=t}}}),n.prototype.PingPongDelay=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.wetLevel=l.createGain(),this.stereoToMonoMix=l.createGain(),this.feedbackLevel=l.createGain(),this.output=l.createGain(),this.delayLeft=l.createDelay(),this.delayRight=l.createDelay(),this.activateNode=l.createGain(),this.splitter=l.createChannelSplitter(2),this.merger=l.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==e.delayTimeLeft?e.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==e.delayTimeRight?e.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==e.feedback?e.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==e.wetLevel?e.wetLevel:this.defaults.wetLevel.value,this.bypass=e.bypass||!1},n.prototype.PingPongDelay.prototype=Object.create(d,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(e){this._delayTimeLeft=e,this.delayLeft.delayTime.value=e/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(e){this._delayTimeRight=e,this.delayRight.delayTime.value=e/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:v},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:v},feedback:{value:.3,min:0,max:1,automatable:!1,type:p},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:p}}}}),n.prototype.Tremolo=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.splitter=this.activateNode=l.createChannelSplitter(2),this.amplitudeL=l.createGain(),this.amplitudeR=l.createGain(),this.merger=l.createChannelMerger(2),this.output=l.createGain(),this.lfoL=new c.LFO({target:this.amplitudeL.gain,callback:f}),this.lfoR=new c.LFO({target:this.amplitudeR.gain,callback:f}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=e.rate||this.defaults.rate.value,this.intensity=u(e.intensity,this.defaults.intensity.value),this.stereoPhase=u(e.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=e.bypass||!1},n.prototype.Tremolo.prototype=Object.create(d,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:p},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:p},rate:{value:5,min:.1,max:11,automatable:!1,type:p}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(e){this._intensity=e,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=o(t,2*Math.PI),this.lfoR.phase=t}}}),n.prototype.WahWah=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.activateNode=l.createGain(),this.envelopeFollower=new c.EnvelopeFollower({target:this,callback:function(e,t){e.sweep=t}}),this.filterBp=l.createBiquadFilter(),this.filterPeaking=l.createBiquadFilter(),this.output=l.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=u(e.enableAutoMode,this.defaults.automode.value),this.resonance=e.resonance||this.defaults.resonance.value,this.sensitivity=u(e.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=u(e.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=e.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=u(e.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=e.bypass||!1},n.prototype.WahWah.prototype=Object.create(d,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:"boolean"},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:p},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:p},sweep:{value:.2,min:0,max:1,automatable:!1,type:p},resonance:{value:10,min:1,max:100,automatable:!1,type:p},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:p}}},activateCallback:{value:function(e){this.automode=e}},automode:{get:function(){return this._automode},set:function(e){this._automode=e,e?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}catch(e){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(e){this._sweep=Math.pow(e>1?1:e<0?0:e,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=50*Math.pow(10,2*e),this._excursionFrequency=Math.min(l.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(e){this._excursionOctaves=e,this._excursionFrequency=Math.min(l.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(e){this._sensitivity=Math.pow(10,e)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(e){this._resonance=e,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),n.prototype.EnvelopeFollower=function(e){e||(e=this.getDefaults()),this.input=l.createGain(),this.jsNode=this.output=l.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=u(e.attackTime,this.defaults.attackTime.value),this.releaseTime=u(e.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=e.target||{},this.callback=e.callback||function(){}},n.prototype.EnvelopeFollower.prototype=Object.create(d,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:p},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:p}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(e){this._attackTime=e,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(e){this._releaseTime=e,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(e){"function"==typeof e?this._callback=e:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(e){this.activated=e,e?(this.jsNode.connect(l.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(e){return function(t){e.compute(t)}}},compute:{value:function(e){var t,i,n,s,r=e.inputBuffer.getChannelData(0).length,o=e.inputBuffer.numberOfChannels;if(i=n=s=0,o>1)for(s=0;s<r;++s)for(;i<o;++i)t=e.inputBuffer.getChannelData(i)[s],n+=t*t/o;else for(s=0;s<r;++s)t=e.inputBuffer.getChannelData(0)[s],n+=t*t;n=Math.sqrt(n),this._envelope<n?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*n):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*n),this._callback(this._target,this._envelope)}}}),n.prototype.LFO=function(e){this.output=l.createScriptProcessor(256,1,1),this.activateNode=l.destination,this.frequency=u(e.frequency,this.defaults.frequency.value),this.offset=u(e.offset,this.defaults.offset.value),this.oscillation=u(e.oscillation,this.defaults.oscillation.value),this.phase=u(e.phase,this.defaults.phase.value),this.target=e.target||{},this.output.onaudioprocess=this.callback(e.callback||function(){}),this.bypass=e.bypass||!1},n.prototype.LFO.prototype=Object.create(d,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:p},offset:{value:.85,min:0,max:22049,automatable:!1,type:p},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:p},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:p}}},frequency:{get:function(){return this._frequency},set:function(e){this._frequency=e,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(e){this._offset=e}},oscillation:{get:function(){return this._oscillation},set:function(e){this._oscillation=e}},phase:{get:function(){return this._phase},set:function(e){this._phase=e}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(e){e?this.output.connect(l.destination):this.output.disconnect(l.destination)}},callback:{value:function(e){var t=this;return function(){t._phase+=t._phaseInc,t._phase>2*Math.PI&&(t._phase=0),e(t._target,t._offset+t._oscillation*Math.sin(t._phase))}}}}),n.toString=n.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}}(this);var t=window.AudioContext||window.webkitAudioContext,i=new t;({UNSUPPORT:!1,SUPPORT_STANDARD_VERSION:1,SUPPORT_DEPRECATED_VERSION:2,isGetUserMediaSupported:function(e){return e.navigator.mediaDevices.getUserMedia?this.SUPPORT_STANDARD_VERSION:e.navigator.getUserMedia?this.SUPPORT_DEPRECATED_VERSION:this.UNSUPPORT},initialize:function(e){e.navigator.mediaDevices=e.navigator.mediaDevices||{},e.navigator.getUserMedia=e.navigator.getUserMedia||e.navigator.webkitGetUserMedia||e.navigator.mozGetUserMedia;var t=this.isGetUserMediaSupported(e);t!=this.UNSUPPORT&&(e.getUserMedia=t==this.SUPPORT_STANDARD_VERSION?e.navigator.mediaDevices.getUserMedia.bind(e.navigator.mediaDevices):function(t){return new Promise(function(i,n){e.navigator.getUserMedia(t,i,n)})})}}).initialize(window),window.getUserMedia?console.log("Your browser supports getUserMedia."):console.log("Your browser does not support getUserMedia.");var n=function(){function e(e,t){var i=-1,n=0,s=0,r=!1;if(e.length<1996)return-1;for(var o=0;o<1e3;o++){var a=(e[o]-128)/128;s+=a*a}if((s=Math.sqrt(s/1e3))<.01)return-1;for(var h=1,u=4;u<=1e3;u++){for(var l=0,o=0;o<1e3;o++)l+=Math.abs((e[o]-128)/128-(e[o+u]-128)/128);if((l=1-l/1e3)>.9&&l>h)r=!0;else if(r)return t/i;h=l,l>n&&(n=l,i=u)}return n>.01?t/i:-1}var t=function(){Math.seed=6,Math.seededRandom=function(e,t){return e=e||1,t=t||0,Math.seed=(9301*Math.seed+49297)%233280,t+Math.seed/233280*(e-t)};for(var e=2*i.sampleRate,t=i.createBuffer(1,e,i.sampleRate),n=t.getChannelData(0),s=0;s<e;s++)n[s]=2*Math.seededRandom()-1;return t}(),n=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e,t){e.env={attack:t.env?A(t.env.attack,1):0,decay:t.env?A(t.env.decay,0):0,sustain:t.env?A(t.env.sustain,1):1,hold:t.env?A(t.env.hold,3.14159):3.14159,release:t.env?A(t.env.release,0):0},e.defaultEnv={attack:t.env?A(t.env.attack,1):0,decay:t.env?A(t.env.decay,0):0,sustain:t.env?A(t.env.sustain,1):1,hold:t.env?A(t.env.hold,3.14159):3.14159,release:t.env?A(t.env.release,0):0}},r=function(e,t){t.filter?n(t.filter)?e.filter=t.filter.map(function(e){return{type:e.type||"lowpass",frequency:e.frequency||600,q:e.q||1,env:e.env||null}}):e.filter=[{type:t.filter.type||"lowpass",frequency:t.filter.frequency||600,q:t.filter.q||1,env:t.filter.env||null}]:t.filter=null},o=function(e,t){var n=new XMLHttpRequest;n.open("GET",e.source,!0),n.responseType="arraybuffer",e.playable--,n.onload=function(){i.decodeAudioData(n.response,function(i){e.decodedBuffer=i,3.14159===e.env.hold&&(e.env.hold=e.decodedBuffer.duration+1),t&&t(e),e.playable++,e.playOnLoad&&e.play(e.playOnLoadArg)})},n.send()},a=function(e,t){t.vibrato?e.vibrato={shape:A(t.vibrato.shape,"sine"),speed:A(t.vibrato.speed,1),magnitude:A(t.vibrato.magnitude,5),attack:A(t.vibrato.attack,0)}:e.vibrato=null},h=function(e,t){t.tremolo?e.tremolo={shape:A(t.tremolo.shape,"sine"),speed:A(t.tremolo.speed,1),magnitude:A(t.tremolo.magnitude,5),attack:A(t.tremolo.attack,1)}:e.tremolo=null},u=function(e,t){if(t.reverb){e.reverb={wet:A(t.reverb.wet,1)};var n=t.reverb.impulse||p.defaultImpulse,s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType="arraybuffer",e.playable--,s.onload=function(){i.decodeAudioData(s.response,function(i){e.reverb.buffer=i,e.playable++,e.playOnLoad&&e.play(e.playOnLoadArg),e instanceof p.Poly&&e.setUp(t),"mic"===e.source&&e.reverb&&e.reverb.buffer&&e.reverb.node&&!e.reverb.node.buffer&&(e.reverb.node.convolver.buffer=e.reverb.buffer)})},s.send()}else e.reverb=null},l=function(e,t){"panning"in t?(e.panning={location:t.panning},"number"==typeof t.panning?e.panning.type="stereo":(e.panning.type="3d",e.panning.panningModel=t.panningModel||"equalpower")):e.panning={location:0,type:"stereo"},"stereo"!==e.panning.type||i.createStereoPanner||(console.log("Your browser does not support stereo panning. Falling back to 3D panning."),e.panning={location:[0,0,0],type:"3d",panningModel:"equalpower"})},c=function(e,t){t.delay?e.delay={delayTime:A(t.delay.delayTime,.5),maxDelayTime:A(t.delay.maxDelayTime,2),feedback:A(t.delay.feedback,.25),wet:A(t.delay.wet,.25)}:e.delay=null},f=function(e,t){e.nodes=[],e.mediaStreamSource=null,e.gain=null,getUserMedia({audio:!0,video:!1}).then(function(n){e.mediaStreamSource=i.createMediaStreamSource(n),p.micConsent=!0,d(e,t)}).catch(function(e){console.log("Error setting up microphone input: ",e)})},d=function(e,t){e.nodes=[],e.gain=i.createGain(),e.gain.gain.value=A(t.volume,e.volume),e.nodes.push(e.mediaStreamSource),e.nodes.push(e.gain),(e.filter||t.filter)&&w(e,t),(e.reverb||t.reverb)&&x(e,t),l(e,t),_(e,t),(e.delay||t.delay)&&S(e,t),C(e,t),e.setUpExternalFxOnPlay(t,i)},p=function(e){if(this.source=e.source,this.destination=e.destination||i.destination,this.volume=A(e.volume,1),this.defaultVolume=this.volume,this.playable=1,this.pitch=p.pitches[e.pitch]||e.pitch||440,this.detune=e.detune||0,this.globalReverb=e.globalReverb||!1,this.gain=[],this.loop=e.loop||!1,this.tuna=e.tuna||null,s(this,e),r(this,e),a(this,e),h(this,e),u(this,e),this.constructExternalFx(e,i),l(this,e),c(this,e),"noise"===this.source)this.decodedBuffer=t;else if("mic"===this.source)f(this,e);else if("object"==typeof this.source){var n=i.createBuffer(2,this.source[0].length,i.sampleRate);n.getChannelData(0).set(this.source[0]),n.getChannelData(1).set(this.source[1]),this.decodedBuffer=n}else this.source in{sine:0,sawtooth:0,square:0,triangle:0}?e.callback&&e.callback(this):o(this,e.callback)};p.micConsent=!1,p.audioContext=i,void 0!=window.Tuna&&(p.tuna=new Tuna(p.audioContext));var v=function(e,t){e.filter.forEach(function(e,i){e.node.frequency.linearRampToValueAtTime(e.frequency,t.exactTime),e.node.frequency.linearRampToValueAtTime(e.env.frequency,t.exactTime+e.env.attack)})},y=function(e,t){e.gain[0].gain.linearRampToValueAtTime(1e-4,t.exactTime),e.gain[0].gain.linearRampToValueAtTime(e.volume,t.exactTime+e.env.attack+1e-5),e.gain[0].gain.linearRampToValueAtTime(e.volume*e.env.sustain,t.exactTime+e.env.attack+e.env.decay+2e-5),e.gain[0].gain.linearRampToValueAtTime(e.volume*e.env.sustain,t.exactTime+e.env.attack+e.env.decay+e.env.hold+3e-5),e.gain[0].gain.linearRampToValueAtTime(1e-4,t.exactTime+e.env.attack+e.env.decay+e.env.hold+e.env.release+4e-5),e.soundSource.start(t.exactTime),e.soundSource.stop(t.exactTime+e.env.attack+e.env.decay+e.env.hold+e.env.release)},m=function(e,t){for(var i=t&&t.destination||e.destination,n=1;n<e.nodes.length;n++){if("custom"===e.nodes[n-1].interface)var s=e.nodes[n-1].output;else var s=e.nodes[n-1];if("custom"===e.nodes[n].interface)var r=e.nodes[n].input;else var r=e.nodes[n];s.connect(r)}if("custom"===e.nodes[e.nodes.length-1].interface)var o=e.nodes[e.nodes.length-1].output;else var o=e.nodes[e.nodes.length-1];o.connect(i),p.reverb&&e.globalReverb&&(e.nodes[e.nodes.length-1].connect(p.reverb.node),p.reverb.node.connect(p.reverb.gain),p.reverb.gain.connect(i))},g=function(e,t){t=t||{},e.soundSource=i.createOscillator(),e.soundSource.type=e.source,t.pitch?t.pitch in p.pitches?e.soundSource.frequency.value=p.pitches[t.pitch]:e.soundSource.frequency.value=t.pitch:e.soundSource.frequency.value=e.pitch,e.soundSource.detune.value=t.detune||e.detune},b=function(e,t){t&&t.env?(e.env.attack=A(t.env.attack,e.defaultEnv.attack),e.env.decay=A(t.env.decay,e.defaultEnv.decay),e.env.sustain=A(t.env.sustain,e.defaultEnv.sustain),e.env.hold=A(t.env.hold,e.defaultEnv.hold),e.env.release=A(t.env.release,e.defaultEnv.release)):e.env={attack:e.defaultEnv.attack,decay:e.defaultEnv.decay,sustain:e.defaultEnv.sustain,hold:e.defaultEnv.hold,release:e.defaultEnv.release}},w=function(e,t){t.filter&&!n(t.filter)&&(t.filter=[t.filter]),e.filter.forEach(function(n,s){n.node=i.createBiquadFilter(),n.node.type=n.type,n.node.frequency.value=t.filter&&t.filter[s]?t.filter[s].frequency||n.frequency:n.frequency,n.node.Q.value=t.filter&&t.filter[s]?t.filter[s].q||n.q:n.q,(t.filter&&t.filter[s].env||e.filter[s].env)&&"mic"!==e.source&&(n.env={attack:t.filter&&t.filter[s].env&&t.filter[s].env.attack||e.filter[s].env.attack,frequency:t.filter&&t.filter[s].env&&t.filter[s].env.frequency||e.filter[s].env.frequency}),e.nodes.push(n.node)})},k=function(e,t){t&&t.filter&&e.filter?(n(t.filter)||(t.filter=[t.filter]),w(e,t)):e.filter&&w(e,e)},x=function(e,t){var n={interface:"custom",input:i.createGain(),convolver:i.createConvolver(),wet:i.createGain(),output:i.createGain()};n.convolver.buffer=e.reverb.buffer,n.wet.gain.value=e.reverb.wet,n.input.connect(n.convolver),n.input.connect(n.output),n.convolver.connect(n.wet),n.wet.connect(n.output),e.reverb.node=n,e.nodes.push(e.reverb.node)},_=function(e,t){var n=t&&t.panning;void 0===n&&(n=e.panning.location),"number"==typeof n?(e.panning.node=i.createStereoPanner(),e.panning.node.pan.value=n,e.panning.type="stereo"):(e.panning.node=i.createPanner(),e.panning.node.setPosition(n[0],n[1],n[2]),e.panning.node.panningModel=t.panningModel||e.panningModel||"equalpower",e.panning.type="3d"),e.nodes.push(e.panning.node)},T=function(e,t){e.vibrato.wad=new p({source:e.vibrato.shape,pitch:e.vibrato.speed,volume:e.vibrato.magnitude,env:{attack:e.vibrato.attack},destination:e.soundSource.frequency}),e.vibrato.wad.play()},O=function(e,t){e.tremolo.wad=new p({source:e.tremolo.shape,pitch:e.tremolo.speed,volume:e.tremolo.magnitude,env:{attack:e.tremolo.attack,hold:10},destination:e.gain[0].gain}),e.tremolo.wad.play()},S=function(e,t){if(e.delay){t.delay||(t.delay={});var n={interface:"custom",input:i.createGain(),output:i.createGain(),delayNode:i.createDelay(e.delay.maxDelayTime),feedbackNode:i.createGain(),wetNode:i.createGain()};n.delayNode.delayTime.value=A(t.delay.delayTime,e.delay.delayTime),n.feedbackNode.gain.value=A(t.delay.feedback,e.delay.feedback),n.wetNode.gain.value=A(t.delay.wet,e.delay.wet),n.input.connect(n.delayNode),n.input.connect(n.output),n.delayNode.connect(n.feedbackNode),n.delayNode.connect(n.wetNode),n.feedbackNode.connect(n.delayNode),n.wetNode.connect(n.output),e.delay.delayNode=n,e.nodes.push(n)}},E=function(e,t){e.compressor=i.createDynamicsCompressor(),e.compressor.attack.value=A(t.compressor.attack,e.compressor.attack.value),e.compressor.knee.value=A(t.compressor.knee,e.compressor.knee.value),e.compressor.ratio.value=A(t.compressor.ratio,e.compressor.ratio.value),e.compressor.release.value=A(t.compressor.release,e.compressor.release.value),e.compressor.threshold.value=A(t.compressor.threshold,e.compressor.threshold.value),e.nodes.push(e.compressor)},C=function(e,t){if(e.tuna||t.tuna){var i={};if(e.tuna)for(var n in e.tuna)i[n]=e.tuna[n];if(t.tuna)for(var n in t.tuna)i[n]=t.tuna[n];console.log("tunaconfig: ",i);for(var n in i){console.log(n);var s=new p.tuna[n](i[n]);e.nodes.push(s)}}};p.prototype.constructExternalFx=function(e,t){},p.prototype.setUpExternalFxOnPlay=function(e,t){},p.prototype.play=function(e){return e=e||{arg:null},this.playable<1?(this.playOnLoad=!0,this.playOnLoadArg=e):"mic"===this.source?p.micConsent?null===e.arg?m(this,e):(r(this,e),a(this,e),h(this,e),u(this,e),this.constructExternalFx(e,i),l(this,e),c(this,e),d(this,e),m(this,e)):console.log("You have not given your browser permission to use your microphone."):(this.nodes=[],e.wait||(e.wait=0),e.volume?this.volume=e.volume:this.volume=this.defaultVolume,this.source in{sine:0,sawtooth:0,square:0,triangle:0}?g(this,e):(this.soundSource=i.createBufferSource(),this.soundSource.buffer=this.decodedBuffer,("noise"===this.source||this.loop||e.loop)&&(this.soundSource.loop=!0)),void 0===e.exactTime&&(e.exactTime=i.currentTime+e.wait),this.nodes.push(this.soundSource),b(this,e),k(this,e),C(this,e),this.setUpExternalFxOnPlay(e,i),this.gain.unshift(i.createGain()),this.gain[0].label=e.label,this.nodes.push(this.gain[0]),this.gain.length>15&&(this.gain.length=15),this.reverb&&x(this,e),_(this,e),S(this,e),m(this,e),this.filter&&this.filter[0].env&&v(this,e),y(this,e),this.vibrato&&T(this),this.tremolo&&O(this)),e.callback&&e.callback(this),this},p.prototype.setVolume=function(e){return this.defaultVolume=e,this.gain.length>0&&(this.gain[0].gain.value=e),this},p.prototype.setSpeed=function(e){var t;return t=e&&e>0?e:0,this.soundSource?this.soundSource.playbackRate.value=t:console.log("Sorry, but the wad does not contain a soundSource!"),this},p.prototype.setDetune=function(e){return this.soundSource.detune.value=e,this},p.prototype.setPanning=function(e){return this.panning.location=e,n(e)&&"3d"===this.panning.type&&this.panning.node?this.panning.node.setPosition(e[0],e[1],e[2]):"number"==typeof e&&"stereo"===this.panning.type&&this.panning.node&&(this.panning.node.pan.value=e),n(e)?this.panning.type="3d":"number"==typeof e&&(this.panning.type="stereo"),this},p.prototype.setReverb=function(e){var t;return t=e&&e>0&&e<1?e:e>=1?1:0,this.reverb?(this.reverb.wet=t,this.reverb.node&&(this.reverb.node.wet.gain.value=t)):console.log("Sorry, but the wad does not contain Reverb!"),this},p.prototype.setDelay=function(e,t,i){var n;n=e&&e>0?e:0;var s;s=t&&t>0&&t<1?t:t>=1?1:0;var r;return r=i&&i>0&&i<1?i:i>=1?1:0,this.delay?(this.delay.delayTime=n,this.delay.wet=s,this.delay.feedback=r,this.delay.delayNode&&(this.delay.delayNode.delayNode.delayTime.value=n,this.delay.delayNode.wetNode.gain.value=s,this.delay.delayNode.feedbackNode.gain.value=r)):console.log("Sorry, but the wad does not contain delay!"),this},p.prototype.stop=function(e){if("mic"!==this.source){if(e)for(var t=0;t<this.gain.length;t++)this.gain[t].label===e&&(this.gain[t].gain.cancelScheduledValues(i.currentTime),this.gain[t].gain.setValueAtTime(this.gain[t].gain.value,i.currentTime),this.gain[t].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release));e||(this.gain[0].gain.cancelScheduledValues(i.currentTime),this.gain[0].gain.setValueAtTime(this.gain[0].gain.value,i.currentTime),this.gain[0].gain.linearRampToValueAtTime(1e-4,i.currentTime+this.env.release))}else p.micConsent?this.mediaStreamSource.disconnect(0):console.log("You have not given your browser permission to use your microphone.");this.tremolo&&this.tremolo.wad.stop()};var M=new Uint8Array(2048),P=function(e){var t=Math.log(e/440)/Math.log(2)*12;return Math.round(t)+69};p.Poly=function(e){e||(e={}),this.isSetUp=!1,this.playable=1,e.reverb?u(this,e):this.setUp(e)},p.Poly.prototype.setUp=function(e){if(this.wads=[],this.input=i.createAnalyser(),this.input.fftSize=2048,this.nodes=[this.input],this.destination=e.destination||i.destination,this.volume=e.volume||1,this.output=i.createGain(),this.output.gain.value=this.volume,this.tuna=e.tuna||null,"undefined"!=typeof Recorder&&e.recConfig){this.rec=new Recorder(this.output,e.recConfig),this.rec.recordings=[];var t=this,n=function(e){t.rec.createWadArg.source=e,t.rec.recordings.unshift(new p(t.rec.createWadArg))};this.rec.createWad=function(e){this.createWadArg=e||{env:{hold:9001}},this.getBuffer(n)}}this.globalReverb=e.globalReverb||!1,r(this,e),this.filter&&w(this,e),this.reverb&&x(this,e),this.constructExternalFx(e,i),l(this,e),_(this,e),e.compressor&&E(this,e),c(this,e),S(this,e),C(this,e),this.nodes.push(this.output),m(this,e),this.isSetUp=!0,e.callback&&e.callback(this)},p.Poly.prototype.updatePitch=function(t){this.input.getByteTimeDomainData(M);var n=e(M,i.sampleRate);if(-1!==n&&11025!==n&&12e3!==n){var s=n;this.pitch=Math.floor(s);var r=P(s);this.noteName=p.pitchesArray[r-12]}var o=this;o.rafID=window.requestAnimationFrame(function(){o.updatePitch()})},p.Poly.prototype.stopUpdatingPitch=function(){cancelAnimationFrame(this.rafID)},p.Poly.prototype.setVolume=function(e){return this.isSetUp?this.output.gain.value=e:console.log("This PolyWad is not set up yet."),this},p.Poly.prototype.play=function(e){if(this.isSetUp)if(this.playable<1)this.playOnLoad=!0,this.playOnLoadArg=e;else{e&&e.volume&&(this.output.gain.value=e.volume,e.volume=void 0);for(var t=0;t<this.wads.length;t++)this.wads[t].play(e)}else console.log("This PolyWad is not set up yet.");return this},p.Poly.prototype.stop=function(e){if(this.isSetUp)for(var t=0;t<this.wads.length;t++)this.wads[t].stop(e)},p.Poly.prototype.add=function(e){return this.isSetUp?(e.destination=this.input,this.wads.push(e),e instanceof p.Poly&&(e.output.disconnect(0),e.output.connect(this.input))):console.log("This PolyWad is not set up yet."),this},p.Poly.prototype.remove=function(e){if(this.isSetUp)for(var t=0;t<this.wads.length;t++)this.wads[t]===e&&(this.wads[t].destination=i.destination,this.wads.splice(t,1),e instanceof p.Poly&&(e.output.disconnect(0),e.output.connect(i.destination)));return this},p.Poly.prototype.constructExternalFx=function(e,t){},p.defaultImpulse="http://www.codecur.io/us/sendaudio/widehall.wav",p.setGlobalReverb=function(e){p.reverb={},p.reverb.node=i.createConvolver(),p.reverb.gain=i.createGain(),p.reverb.gain.gain.value=e.wet;var t=e.impulse||p.defaultImpulse,n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){i.decodeAudioData(n.response,function(e){p.reverb.node.buffer=e})},n.send()};var A=function(e,t){return null==e?t:e};p.pitches={A0:27.5,"A#0":29.1352,Bb0:29.1352,B0:30.8677,"B#0":32.7032,Cb1:30.8677,C1:32.7032,"C#1":34.6478,Db1:34.6478,D1:36.7081,"D#1":38.8909,Eb1:38.8909,E1:41.2034,Fb1:41.2034,"E#1":43.6535,F1:43.6535,"F#1":46.2493,Gb1:46.2493,G1:48.9994,"G#1":51.9131,Ab1:51.9131,A1:55,"A#1":58.2705,Bb1:58.2705,B1:61.7354,Cb2:61.7354,"B#1":65.4064,C2:65.4064,"C#2":69.2957,Db2:69.2957,D2:73.4162,"D#2":77.7817,Eb2:77.7817,E2:82.4069,Fb2:82.4069,"E#2":87.3071,F2:87.3071,"F#2":92.4986,Gb2:92.4986,G2:97.9989,"G#2":103.826,Ab2:103.826,A2:110,"A#2":116.541,Bb2:116.541,B2:123.471,Cb3:123.471,"B#2":130.813,C3:130.813,"C#3":138.591,Db3:138.591,D3:146.832,"D#3":155.563,Eb3:155.563,E3:164.814,Fb3:164.814,"E#3":174.614,F3:174.614,"F#3":184.997,Gb3:184.997,G3:195.998,"G#3":207.652,Ab3:207.652,A3:220,"A#3":233.082,Bb3:233.082,B3:246.942,Cb4:246.942,"B#3":261.626,C4:261.626,"C#4":277.183,Db4:277.183,D4:293.665,"D#4":311.127,Eb4:311.127,E4:329.628,Fb4:329.628,"E#4":349.228,F4:349.228,"F#4":369.994,Gb4:369.994,G4:391.995,"G#4":415.305,Ab4:415.305,A4:440,"A#4":466.164,Bb4:466.164,B4:493.883,Cb5:493.883,"B#4":523.251,C5:523.251,"C#5":554.365,Db5:554.365,D5:587.33,"D#5":622.254,Eb5:622.254,E5:659.255,Fb5:659.255,"E#5":698.456,F5:698.456,"F#5":739.989,Gb5:739.989,G5:783.991,"G#5":830.609,Ab5:830.609,A5:880,"A#5":932.328,Bb5:932.328,B5:987.767,Cb6:987.767,"B#5":1046.5,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,Fb6:1318.51,E6:1318.51,"E#6":1396.91,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,Cb7:1975.53,"B#6":2093,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,Fb7:2637.02,"E#7":2793.83,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,Cb8:3951.07,"B#7":4186.01,C8:4186.01},p.pitchesArray=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8"],p.midiInstrument={play:function(){console.log("playing midi")},stop:function(){console.log("stopping midi")}},p.midiInputs=[],midiMap=function(e){console.log(e.receivedTime,e.data),144===e.data[0]?0===e.data[2]?(console.log("|| stopping note: ",p.pitchesArray[e.data[1]-12]),p.midiInstrument.stop(p.pitchesArray[e.data[1]-12])):e.data[2]>0&&(console.log("> playing note: ",p.pitchesArray[e.data[1]-12]),p.midiInstrument.play({pitch:p.pitchesArray[e.data[1]-12],label:p.pitchesArray[e.data[1]-12],callback:function(e){}})):176===e.data[0]?(console.log("controller"),46==e.data[1]&&(127==e.data[2]?p.midiInstrument.pedalMod=!0:0==e.data[2]&&(p.midiInstrument.pedalMod=!1))):224===e.data[0]&&console.log("pitch bend")};var j=function(e){p.midiInputs=[];for(var t=e.inputs.values(),i=t.next();!i.done;i=t.next())p.midiInputs.push(i.value);console.log("MIDI inputs: ",p.midiInputs);for(var n=0;n<p.midiInputs.length;n++)p.midiInputs[n].onmidimessage=midiMap},F=function(e){console.log("uh-oh! Something went wrong!  Error code: "+e.code)};if(navigator&&navigator.requestMIDIAccess)try{navigator.requestMIDIAccess().then(j,F)}catch(e){var L="There was an error on this page.\n\n";L+="Error description: "+e.message+"\n\n",L+="Click OK to continue.\n\n",console.log(L)}return p.presets={hiHatClosed:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.03,release:.01},filter:{type:"highpass",frequency:400,q:1}},snare:{source:"noise",env:{attack:.001,decay:.01,sustain:.2,hold:.03,release:.02},filter:{type:"bandpass",frequency:300,q:.18}},hiHatOpen:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.43,release:.01},filter:{type:"highpass",frequency:100,q:.2}},ghost:{source:"square",volume:.3,env:{attack:.01,decay:.002,sustain:.5,hold:2.5,release:.3},filter:{type:"lowpass",frequency:600,q:7,env:{attack:.7,frequency:1600}},vibrato:{attack:8,speed:8,magnitude:100}},piano:{source:"square",volume:1.4,env:{attack:.01,decay:.005,sustain:.2,hold:.015,release:.3},filter:{type:"lowpass",frequency:1200,q:8.5,env:{attack:.2,frequency:600}}}},p}();return void 0!==e&&e.exports&&(e.exports=n),n})},/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},/*!***********************!*\
  !*** vertx (ignored) ***!
  \***********************/
function(e,t){},/*!***********************************!*\
  !*** multi ./js/athena-module.js ***!
  \***********************************/
function(e,t,i){e.exports=i(/*! ./js/athena-module.js */20)}])})},/*!**********************!*\
  !*** ./js/tetris.js ***!
  \**********************/
function(e,t,i){"use strict";var n=i(/*! athenajs */0),s=i(/*! ./grid */3),r=function(e){return e&&e.__esModule?e:{default:e}}(s);new n.Game({name:"athena-tetris",showFps:!0,debug:!0,width:800,height:600,scene:new r.default})},/*!***************************!*\
  !*** ./js/flash_lines.js ***!
  \***************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(/*! athenajs */0),h=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"flashlines",Object.assign({},{},i)));return r.lines=[],r.lineHeight=i.lineHeight,r}return r(t,e),o(t,[{key:"flash",value:function(e,t){return this.animate("Fade",{startValue:1,endValue:0,duration:400,loop:2})}},{key:"render",value:function(){for(var e=0;e<this.lines.length;++e){var t=this.lines[e];this.rect(0,t*this.lineHeight,this.width,this.lineHeight,"white")}}}]),t}(a.Paint);t.default=h},/*!********************!*\
  !*** ./js/grid.js ***!
  \********************/
function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=i(/*! athenajs */0),u=i(/*! ./shape */4),l=n(u),c=i(/*! ./flash_lines */2),f=n(c),d=1200,p=function(e){function t(){s(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{resources:[{id:"tiles",type:"image",src:"img/tetris_tiles.png"},{id:"gameover",type:"audio",src:"sound/gameover.mp3"},{id:"ground",type:"audio",src:"sound/ground.mp3"},{id:"level",type:"audio",src:"sound/level.mp3"},{id:"lines",type:"audio",src:"sound/lines.mp3"},{id:"lines_tetris",type:"audio",src:"sound/lines_tetris.mp3"},{id:"move",type:"audio",src:"sound/move.mp3"},{id:"pause",type:"audio",src:"sound/pause.mp3"},{id:"rotate",type:"audio",src:"sound/rotate.mp3"}]}));return e.score=0,e.level=0,e.lines=0,e.timing=d,e.scoreTable=[40,100,300,1200],e.bindEvents("shape:ground"),e}return o(t,e),a(t,[{key:"generateTileSet",value:function(){for(var e=[{offsetX:140,offsetY:440,width:20,height:20}],t=0,i=0;t<7;++t,i+=20)e.push({offsetX:i,offsetY:440,width:20,height:20});return e.push({offsetX:160,offsetY:440,width:20,height:20}),e}},{key:"createMap",value:function(){var e=new h.Map({src:"tiles",tileWidth:20,tileHeight:20,width:240,height:440,buffer:new ArrayBuffer(528)});return e.addTileSet(this.generateTileSet()),e}},{key:"resetMap",value:function(){var e=this.map;e.clear(0,h.Tile.TYPE.AIR);for(var t=0;t<e.numRows;++t)e.updateTile(0,t,8,h.Tile.TYPE.WALL),e.updateTile(e.numCols-1,t,8,h.Tile.TYPE.WALL);for(var i=0;i<e.numCols;++i)e.updateTile(i,e.numRows-1,8,h.Tile.TYPE.WALL)}},{key:"createShapes",value:function(){this.shape=new l.default("shape",{data:{speed:this.timing}}),this.nextShape=new l.default("nextShape",{x:610,y:110}),this.nextShape.movable=!1,this.nextString=new h.SimpleText("nextString",{text:"Next",x:620,y:70}),this.scoreString=new h.SimpleText("scoreString",{text:"Score: 0",x:50,y:70}),this.linesString=new h.SimpleText("linesString",{text:"Lines: 0",x:50,y:120}),this.levelString=new h.SimpleText("levelString",{text:"Level: 0",x:50,y:170}),this.pauseString=new h.SimpleText("pauseString",{text:"Pause",x:380,y:550,visible:!1}),this.controls=new h.SimpleText("controlsString",{text:"Controls:\narrow keys",x:50,y:220}),this.flashLines=new f.default("flash",{x:300,y:80,width:200,lineHeight:20})}},{key:"setup",value:function(){this.createShapes(),this.map=this.createMap()}},{key:"start",value:function(){var e=this.map;this.setBackgroundImage("img/background.png"),this.setMap(e,(800-e.width)/2,(600-e.height)/2),e.addObject(this.shape),this.addObject([this.nextShape,this.nextString,this.linesString,this.scoreString,this.levelString,this.pauseString,this.flashLines,this.controls]),this.reset()}},{key:"reset",value:function(){this.score=0,this.level=0,this.lines=0,this.timing=d,this.resetMap(),this.shape.moveToTop(),this.shape.setRandomShape(),this.nextShape.setRandomShape(),this.linesString.setText("Lines: "+this.lines),this.scoreString.setText("Score: "+this.score),this.levelString.setText("Level: "+this.level),this.shape.movable=!0,this.shape.behavior.reset()}},{key:"gameover",value:function(){h.AudioManager.play("gameover"),alert("game over!"+this.score),this.reset()}},{key:"onEvent",value:function(e){var t=this,i=this.nextShape,n=this.shape;switch(e.type){case"shape:ground":this.updateMap(),this.removeLinesFromMap(e.data.startLine,e.data.numRows).then(function(){n.setShape(i.shapeName,i.rotation),i.setRandomShape(),t.shape.moveToTop(),t.shape.snapTile(0,0,!1)?t.shape.movable=!0:t.gameover()})}}},{key:"updateMap",value:function(){for(var e=this.shape,t=this.shape.shape,i=this.map,n=i.getTileIndexFromPixel(e.x,e.y),s=e.getMatrix(),r=t.height/i.tileHeight,o=t.width/i.tileWidth,a=0;a<r;++a)for(var u=0;u<o;++u)s[a*o+u]&&i.updateTile(n.x+u,n.y+a,t.color,h.Tile.TYPE.WALL)}},{key:"getLinesToRemove",value:function(e,t){console.log("[Grid] getLinesToRemove()");var i=this.map,n=[],s=e+t-1;s>i.numRows-2&&(s=i.numRows-2);for(var r=s;r>=e;--r){for(var o=!1,a=1;a<i.numCols-1;++a)o=o||i.getTileBehaviorAtIndex(a,r)!==h.Tile.TYPE.WALL;o||n.push(r)}return n}},{key:"updateLevel",value:function(){var e=this.level;this.level=Math.floor(this.lines/10),this.levelString.setText("Level: "+this.level),this.timing=d-55*this.level,this.shape.data.speed=this.timing,e!==this.level&&h.AudioManager.play("level")}},{key:"increaseScore",value:function(e){this.score+=this.scoreTable[e-1]+this.level*this.scoreTable[e-1],this.lines+=e,this.linesString.setText("Lines: "+this.lines),this.scoreString.setText("Score: "+this.score),4===e?h.AudioManager.play("lines_tetris"):h.AudioManager.play("lines")}},{key:"removeLinesFromMap",value:function(e,t){var i=this,n=this.map,s=this.getLinesToRemove(e,t);return s.length?(this.flashLines.lines=s,this.flashLines.flash().then(function(){for(var e=0;e<s.length;++e)n.shift(s[e]+e,1);for(var r=0;r<t;++r){for(var o=0;o<n.numCols;++o)n.updateTile(o,r,0,h.Tile.TYPE.AIR);n.updateTile(0,r,8,h.Tile.TYPE.WALL),n.updateTile(n.numCols-1,r,8,h.Tile.TYPE.WALL)}(0,h.Dom)(".athena-game").addClass("shake-vertical shake-constant"),setTimeout(function(){(0,h.Dom)(".athena-game").removeClass("shake-vertical shake-constant")},300),i.increaseScore(s.length),i.updateLevel()})):h.Deferred.resolve(!0)}},{key:"pause",value:function(e){this.pauseString.visible=!e,h.AudioManager.play("pause")}}]),t}(h.Scene);t.default=p},/*!*********************!*\
  !*** ./js/shape.js ***!
  \*********************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(/*! athenajs */0),h=i(/*! ./shape_behavior */5),u=function(e){return e&&e.__esModule?e:{default:e}}(h),l=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Object.assign({},{imageId:"tiles",easing:"linear",behavior:u.default},i)));return r.shapes=[{name:"I",width:80,height:80,color:7,rotations:[[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],[0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0],[0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0]]},{name:"J",width:60,height:60,color:6,rotations:[[1,0,0,1,1,1,0,0,0],[0,1,1,0,1,0,0,1,0],[0,0,0,1,1,1,0,0,1],[0,1,0,0,1,0,1,1,0]]},{name:"L",width:60,height:60,color:5,rotations:[[0,0,1,1,1,1,0,0,0],[0,1,0,0,1,0,0,1,1],[0,0,0,1,1,1,1,0,0],[1,1,0,0,1,0,0,1,0]]},{name:"O",width:80,height:60,color:4,rotations:[[0,1,1,0,0,1,1,0,0,0,0,0],[0,1,1,0,0,1,1,0,0,0,0,0],[0,1,1,0,0,1,1,0,0,0,0,0],[0,1,1,0,0,1,1,0,0,0,0,0]]},{name:"S",width:60,height:60,color:3,rotations:[[0,1,1,1,1,0,0,0,0],[0,1,0,0,1,1,0,0,1],[0,0,0,0,1,1,1,1,0],[1,0,0,1,1,0,0,1,0]]},{name:"Z",width:60,height:60,color:2,rotations:[[1,1,0,0,1,1,0,0,0],[0,0,1,0,1,1,0,1,0],[0,0,0,1,1,0,0,1,1],[0,1,0,1,1,0,1,0,0]]},{name:"T",width:60,height:60,color:1,rotations:[[0,1,0,1,1,1,0,0,0],[0,1,0,0,1,1,0,1,0],[0,0,0,1,1,1,0,1,0],[0,1,0,1,1,0,0,1,0]]}],r.addAnimations(),r.setShape("S",0),r}return r(t,e),o(t,[{key:"moveToTop",value:function(){var e=this.currentMap,t=Math.floor((e.width-this.shape.width)/2/e.tileWidth);this.moveTo(t*e.tileWidth,0)}},{key:"setShape",value:function(e,t){var i=this;this.shapeName=e,this.rotation=t,this.shape=this.shapes.find(function(e){return e.name===i.shapeName}),this.setAnimation(""+e+t)}},{key:"setRandomShape",value:function(e){var t=this,i=this.shapes[7*Math.random()|0].name,n=4*Math.random()|0;console.log("[Shape] setRandomShape() - "+this.type+", "+i),this.movable?this.setShape(i,n):this.animate("Fade",{duration:200,startValue:1,endValue:0}).then(function(){t.setShape(i,n),t.animate("Fade",{duration:200,startValue:0,endValue:1})})}},{key:"getMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.shape.rotations[-1===e?this.rotation:e]}},{key:"snapTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],this.currentMap),s=this.getMatrix(),r=n.getTileIndexFromPixel(this.x,this.y),o=r.x+e,h=r.y+t;return n.checkMatrixForCollision(s,this.shape.width,o,h,a.Tile.TYPE.WALL)?(1===t&&(this.movable=!1,i&&(a.AudioManager.play("ground"),this.notify("ground",{startLine:r.y,numRows:this.shape.height/n.tileHeight}))),!1):(this.x+=e*n.tileWidth,this.y+=t*n.tileHeight,!0)}},{key:"nextRotation",value:function(){var e=null,t=this.rotation+1,i=this.currentMap,n=i.getTileIndexFromPixel(this.x,this.y);t>3&&(t=0),e=this.getMatrix(t),i.checkMatrixForCollision(e,this.shape.width,n.x,n.y,a.Tile.TYPE.WALL)?console.log("rotation not possible"):(this.setShape(this.shapeName,t),a.AudioManager.play("rotate"))}},{key:"addAnimations",value:function(){var e=this,t=0;this.shapes.forEach(function(i){for(var n=0,s=0;s<4;++s)e.addAnimation(""+i.name+s,"tiles",{offsetY:t,offsetX:n,frameWidth:i.width,frameHeight:i.height,frameDuration:1,numFrames:1}),n+=i.width;t+=i.height})}}]),t}(a.Sprite);t.default=l},/*!******************************!*\
  !*** ./js/shape_behavior.js ***!
  \******************************/
function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(/*! athenajs */0),h=function(e){function t(e,i){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.state=0,r.lastRotation=0,r.ts=0,r.LONG_DELAY=250,r.SMALL_DELAY=70,r.reset(),r}return r(t,e),o(t,[{key:"reset",value:function(){a.InputManager.clearEvents(),this.delay=this.LONG_DELAY,this.key=0,this.timerEnabled=!0}},{key:"ready",value:function(e,t){return this.state!==e?(this.ts=t,this.state=e,this.delay=this.LONG_DELAY,!0):t-this.ts>this.delay&&(this.ts=t,this.delay=this.SMALL_DELAY,!0)}},{key:"timer",value:function(e){var t=this.sprite;if(this.startTime){if(e-this.startTime>t.data.speed)return this.startTime=e,!0}else this.startTime=e;return!1}},{key:"checkKeyDelay",value:function(e,t,i,n){this.ready(e,t)&&this.sprite.snapTile(i,n)&&a.AudioManager.play("move")}},{key:"onUpdate",value:function(e){var t=this.sprite;return a.InputManager.isKeyDown(84)?void(this.timerEnabled=!this.timerEnabled):this.timerEnabled&&this.timer(e)?void t.snapTile(0,1):void(a.InputManager.isKeyDown("DOWN")?this.checkKeyDelay(1,e,0,1):a.InputManager.isKeyDown("LEFT")?this.checkKeyDelay(2,e,-1,0):a.InputManager.isKeyDown("RIGHT")?this.checkKeyDelay(3,e,1,0):(a.InputManager.isKeyDown("UP")||a.InputManager.isKeyDown("SPACE"))&&e-this.lastRotation>150?(this.lastRotation=e,t.nextRotation()):this.state&&this.ready(0,e))}}]),t}(a.Behavior);t.default=h},/*!****************************!*\
  !*** multi ./js/tetris.js ***!
  \****************************/
function(e,t,i){e.exports=i(/*! ./js/tetris.js */1)}]);